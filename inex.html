  <!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mora for Studying</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Orbitron:wght@500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        /* --- الإعدادات الأساسية والثيمات --- */
        :root {
            --transition-speed: 0.5s;
        }
        
        body {
            --accent-color: #00ff7f; 
            --accent-glow: rgba(0, 255, 127, 0.4); 
            --accent-hover: #33ff99;
            --primary-bg: #05080f; --secondary-bg: #10141f; --glass-bg: rgba(16, 20, 31, 0.75); --primary-text-color: #e1e1ff; --border-color: rgba(0, 255, 127, 0.25);
        }
        body.mode-light { --primary-bg: #f0f2f5; --secondary-bg: #ffffff; --glass-bg: rgba(255, 255, 255, 0.85); --primary-text-color: #1c1e21; --border-color: rgba(0,0,0, 0.2); }
        body.mode-oled { --primary-bg: #000000; --secondary-bg: #111111; --glass-bg: rgba(17, 17, 17, 0.75); --primary-text-color: #e1e1ff; --border-color: rgba(0, 255, 127, 0.25); }
        body.mode-gold-black { --primary-bg: #000000; --secondary-bg: #1a1a1a; --glass-bg: rgba(26, 26, 26, 0.75); --primary-text-color: #f0e6d2; --border-color: rgba(212, 175, 55, 0.3); --accent-color: #d4af37; --accent-glow: rgba(212, 175, 55, 0.4); --accent-hover: #b89b31; }
        
        /* --- التنسيقات العامة --- */
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Cairo', sans-serif; }
        html { scroll-behavior: smooth; }
        body { background-color: var(--primary-bg); color: var(--primary-text-color); transition: background-color var(--transition-speed) ease, color var(--transition-speed) ease; min-height: 100vh; overflow: hidden; }
        
        /* --- خلفية متحركة --- */
        .animated-bg { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden; background: var(--primary-bg); }
        #login-animation-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        .glow-element { position: absolute; border-radius: 50%; filter: blur(150px); z-index: -2; }
        #glow1 { width: 400px; height: 400px; background: var(--accent-color); top: 10%; left: 10%; opacity: 0.3; }
        #glow2 { width: 300px; height: 300px; background: var(--accent-hover); bottom: 5%; right: 5%; opacity: 0.4; }
        
        /* --- نظام الصفحات --- */
        .page { display: flex; flex-direction: column; align-items: center; justify-content: center; position: absolute; top:0; left:0; width:100%; height:100%; transition: opacity 0.7s ease, transform 0.7s ease; opacity: 0; pointer-events: none; z-index: 2; }
        .page.active { opacity: 1; pointer-events: auto; }
        .page.exit { opacity: 0; transform: none; }
        
        #login-page { gap: 20px; padding: 20px; overflow-y: auto; } 
        #main-page, #admin-panel { padding-top: 0; justify-content: flex-start; }

        /* === شاشة التحميل === */
        #loading-page .loading-container { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 25px; }
        #loading-page .loading-spinner { position: relative; width: 120px; height: 120px; display: flex; align-items: center; justify-content: center; }
        #loading-page .loading-logo { width: 85px; height: 85px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color); box-shadow: 0 0 20px var(--accent-glow), inset 0 0 10px rgba(0,0,0,0.4); animation: pulse-logo-loading 2.5s infinite ease-in-out; }
        @keyframes pulse-logo-loading { 0%, 100% { transform: scale(1); box-shadow: 0 0 20px var(--accent-glow), inset 0 0 10px rgba(0,0,0,0.4); } 50% { transform: scale(1.05); box-shadow: 0 0 30px var(--accent-color), inset 0 0 10px rgba(0,0,0,0.4); } }
        #loading-page .progress-ring { position: absolute; top: 0; left: 0; transform: rotate(-90deg); }
        #loading-page .progress-ring__circle-bg { stroke: var(--border-color); }
        #loading-page .progress-ring__circle { stroke: var(--accent-color); stroke-linecap: round; animation: progress-stroke 2s linear infinite; stroke-dasharray: 339.29; stroke-dashoffset: 339.29; }
        @keyframes progress-stroke { 0% { stroke-dashoffset: 339.29; } 50% { stroke-dashoffset: 0; } 100% { stroke-dashoffset: -339.29; } }
        #loading-page .loading-text { font-size: 1.6rem; font-weight: 700; color: var(--primary-text-color); text-shadow: 0 0 10px var(--accent-glow); animation: subtleGlow 2.5s infinite alternate ease-in-out; text-align: center; }
        @keyframes subtleGlow { from { opacity: 0.7; transform: scale(1); } to { opacity: 1; transform: scale(1.02); } }
        #loading-page #wait-message { font-family: 'Orbitron', sans-serif; font-size: 1.1rem; font-weight: 600; color: var(--primary-text-color); opacity: 0; text-shadow: 0 0 8px var(--accent-glow); letter-spacing: 1px; margin-top: 10px; animation: fadeInOutWait 2s infinite alternate ease-in-out; animation-delay: 1.5s; }
        @keyframes fadeInOutWait { from { opacity: 0.4; transform: translateY(5px); } to { opacity: 0.9; transform: translateY(-5px); } }

        /* --- واجهة تسجيل الدخول --- */
        .login-header { display: flex; flex-direction: column; align-items: center; gap: 15px; margin-bottom: 30px; text-align: center; }
        .login-header img { width: 150px; height: 150px; border-radius: 50%; object-fit: cover; border: 3px solid var(--border-color); padding: 5px; box-shadow: 0 0 15px var(--accent-glow), 0 0 30px var(--accent-color), 0 0 50px var(--accent-glow), inset 0 0 10px rgba(0,0,0,0.5); animation: float-logo 5s ease-in-out infinite; }
        @keyframes float-logo { 0% { transform: translateY(0px) rotate(-2deg) scale(1); } 50% { transform: translateY(-20px) rotate(2deg) scale(1.05); } 100% { transform: translateY(0px) rotate(-2deg) scale(1); } }
        .login-header .welcome-text { font-family: 'Orbitron', sans-serif; font-size: 1rem; font-weight: 700; color: var(--accent-color); text-shadow: 0 0 10px var(--accent-glow); letter-spacing: 2px; opacity: 0.9; }
        .auth-choice-container, .auth-view { background: transparent; padding: 15px; width: 100%; max-width: 300px; display: none; flex-direction: column; align-items: center; position: relative; }
        .auth-view { gap: 20px; animation: fadeInContent 0.8s backwards; max-width: 350px; }
        .auth-choice-container { gap: 20px; justify-content: center; }
        .auth-view.active, .auth-choice-container.active { display: flex; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(25px); } to { opacity: 1; transform: translateY(0); } }
        .auth-choice-container.active .login-header { animation: fadeInUp 0.7s 0.1s backwards; }
        .auth-choice-container.active #create-account-choice-btn { animation: fadeInUp 0.7s 0.3s backwards; }
        .auth-choice-container.active #login-choice-btn { animation: fadeInUp 0.7s 0.5s backwards; }
        #create-account-view { max-width: 340px; }
        #create-account-form { gap: 18px; }
        #create-account-view .auth-title { margin-bottom: 15px; margin-top: 5px; }
        .auth-btn { position: relative; width: 100%; padding: 10px 18px; font-size: 1.1rem; border: 1.5px solid var(--accent-color); color: #fff; text-shadow: 0 0 4px #fff, 0 0 10px var(--accent-color), 0 0 18px var(--accent-glow); background: transparent; border-radius: 8px; font-weight: 700; letter-spacing: 1px; cursor: pointer; box-shadow: 0 0 18px -2px var(--accent-glow); transition: all 0.4s ease; }
        .auth-btn:hover { border-color: var(--accent-hover); box-shadow: 0 0 25px var(--accent-color), 0 0 8px var(--accent-glow) inset; transform: scale(1.03) translateY(-2px); text-shadow: 0 0 5px #fff, 0 0 12px var(--accent-hover), 0 0 22px var(--accent-glow); }
        .back-to-choice-btn { position: absolute; top: 10px; right: 10px; background: transparent; border: none; color: var(--primary-text-color); font-size: 1.5rem; cursor: pointer; opacity: 0.7; transition: all 0.3s ease; padding: 5px 10px; z-index: 5; }
        [dir="ltr"] .back-to-choice-btn { right: auto; left: 10px; }
        .back-to-choice-btn:hover { opacity: 1; color: var(--accent-color); transform: scale(1.1); }
        .auth-form { width: 100%; display: flex; flex-direction: column; gap: 20px; }
        .auth-title { font-family: 'Orbitron', sans-serif; font-size: 2rem; font-weight:900; text-align: center; color: var(--primary-text-color); margin-bottom: 20px; margin-top:10px; text-shadow: 0 0 15px var(--accent-glow); }
        @keyframes fadeInContent { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .input-group { position: relative; }
        .input-group label { position: absolute; top: 12px; right: 5px; color: var(--primary-text-color); opacity: 0.7; pointer-events: none; transition: all 0.3s ease; }
        [dir=ltr] .input-group label { right: auto; left: 5px; }
        .input-group input, .input-group select, .input-group textarea { width:100%; padding: 12px 5px; background: transparent; border: none; border-bottom: 2px solid var(--border-color); color: var(--primary-text-color); font-size: 1rem; transition: border-color 0.3s ease; }
        .input-group input:-webkit-autofill, .input-group input:-webkit-autofill:hover, .input-group input:-webkit-autofill:focus, .input-group input:-webkit-autofill:active { -webkit-text-fill-color: var(--primary-text-color) !important; -webkit-box-shadow: 0 0 0 30px var(--primary-bg) inset !important; background-color: transparent !important; }
        .input-group input:focus + label, .input-group input:not(:placeholder-shown) + label, .input-group textarea:focus + label, .input-group textarea:not(:placeholder-shown) + label, .input-group label.active-programmatically { top: -14px; font-size: 0.8rem; opacity: 1; color: var(--accent-color); }
        .input-group input:focus, .input-group select:focus, .input-group textarea:focus { outline: none; border-bottom-color: var(--accent-color); box-shadow: 0 5px 15px -5px var(--accent-glow); }
        .input-group input::placeholder, .input-group textarea::placeholder { color: transparent; }
        .password-wrapper { position: relative; display: flex; align-items: center; }
        .password-wrapper input { padding-left: 40px; }
        [dir=ltr] .password-wrapper input { padding-left: 5px; padding-right: 40px; }
        .password-toggle { position: absolute; left: 10px; top: 50%; transform: translateY(-50%); cursor: pointer; color: var(--primary-text-color); opacity: 0.7; }
        [dir=ltr] .password-toggle { left: auto; right: 10px; }
        .password-toggle:hover { opacity: 1; color: var(--accent-color); }
        .password-hint { font-size: 0.8rem; text-align: center; color: var(--primary-text-color); opacity: 0.7; margin-top: -15px; }
        .input-group select { color: var(--primary-text-color); opacity: 0.7; }
        .input-group select:valid { opacity: 1; }
        .input-group select option { background-color: var(--secondary-bg); color: var(--primary-text-color); }
        .input-group select option[value=""][disabled] { display: none; }
        .input-group select { background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23e1e1ff' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M11 13L5 8l6-5'/%3e%3c/svg%3e"); background-repeat: no-repeat; background-position: left .75rem center; background-size: 12px; -webkit-appearance: none; appearance: none; padding-right: 35px; }
        [dir=ltr] .input-group select { background-position: right .75rem center; padding-right: 5px; padding-left: 35px; }
        .submit-btn { width: 100%; padding: 14px 20px; background: transparent; border: none; color: var(--accent-color); border-radius: 8px; font-family: 'Orbitron', sans-serif; font-size: 1.4rem; font-weight: 900; letter-spacing: 3px; cursor: pointer; transition: all .4s ease; text-transform: uppercase; text-shadow: 0 0 8px var(--accent-color), 0 0 20px var(--accent-glow), 0 0 35px var(--accent-glow); margin-top: 10px; box-shadow: 0 0 20px -5px var(--accent-glow); position: relative; overflow: hidden; }
        .submit-btn:hover:not(:disabled) { transform: translateY(-3px) scale(1.02); text-shadow: 0 0 12px var(--accent-color), 0 0 30px var(--accent-color), 0 0 50px var(--accent-glow); box-shadow: 0 0 30px var(--accent-glow); }
        .submit-btn:disabled { color: #888; cursor: not-allowed; opacity: .6; transform: none; text-shadow: none; background: transparent; box-shadow: none; border-color: #888;}
        #semester-warning { color: var(--accent-hover); text-align: center; height: 20px; font-weight: 600; font-size: .8rem; margin-top: -10px; }
        .captcha-container-numeric { display: flex; align-items: center; gap: 8px; }
        #captcha-canvas { border: none; border-radius: 5px; background-color: rgba(255, 255, 255, 0.05); flex-shrink: 0; }
        #captcha-refresh-btn { background: transparent; border: none; color: var(--primary-text-color); font-size: 1.3rem; cursor: pointer; transition: all 0.3s ease; padding: 5px; }
        #captcha-refresh-btn:hover { color: var(--accent-color); transform: rotate(180deg); }
        .captcha-container-numeric .input-group { flex-grow: 1; flex-basis: auto; animation: none; margin-top: 0; transform: none; }
        .captcha-container-numeric .input-group input { text-align: center; letter-spacing: 3px; }
        #auth-message { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--glass-bg); padding: 20px 30px; border-radius: 10px; z-index: 1001; text-align: center; font-size: 1.1rem; font-weight: 600; backdrop-filter: blur(5px); display: none; animation: fadeInCenter 0.5s; }
        @keyframes fadeInCenter { from { opacity: 0; transform: translate(-50%, -50%) scale(0.9); } to { opacity: 1; transform: translate(-50%, -50%) scale(1); } }
        
        /* --- لوحة التحكم (Admin Panel) --- */
        #admin-panel { padding: 0; justify-content: flex-start; flex-direction: row; align-items: flex-start; background: var(--primary-bg); }
        .admin-container { display: flex; width: 100%; height: 100%; }
        .admin-sidebar { width: 240px; background: var(--glass-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); padding: 20px; height: 100vh; overflow-y: auto; flex-shrink: 0; border-left: 1px solid var(--border-color); display: flex; flex-direction: column; }
        [dir="ltr"] .admin-sidebar { border-left: none; border-right: 1px solid var(--border-color); }
        .admin-sidebar h1 { font-family: 'Orbitron', sans-serif; font-size: 1.5rem; text-shadow: 0 0 8px var(--accent-glow); margin-bottom: 30px; text-align: center;}
        .admin-nav { list-style: none; padding: 0; flex-grow: 1; }
        .admin-nav-item { margin-bottom: 10px; }
        .admin-nav-link { display: flex; align-items: center; gap: 12px; padding: 12px 15px; color: var(--primary-text-color); text-decoration: none; border-radius: 8px; transition: background-color 0.3s, color 0.3s; opacity: 0.8; }
        .admin-nav-link i { font-size: 1.1rem; width: 20px; text-align: center; }
        .admin-nav-link:hover { background: rgba(255, 255, 255, 0.1); opacity: 1; }
        .admin-nav-link.active { background: var(--accent-color); color: var(--primary-bg) !important; font-weight: 700; text-shadow: none; opacity: 1; }
        #admin-logout-btn { background: transparent !important; border: 1px solid #ff4d4d !important; color: #ff4d4d !important; width: 100%; margin-top: auto; padding: 12px; }
        #admin-logout-btn:hover { background: rgba(255, 77, 77, 0.1) !important; text-shadow: 0 0 8px rgba(255, 77, 77, 0.6); }

        .admin-main-content { flex-grow: 1; padding: 30px; overflow-y: auto; height: 100vh; }
        .admin-view { display: none; }
        .admin-view.active { display: block; animation: fadeInContent 0.5s; }
        .admin-view h2 { margin-bottom: 20px; border-bottom: 1px solid var(--border-color); padding-bottom: 15px; font-size: 1.8rem; }
        .stats-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; }
        .stat-card { background: transparent; padding: 20px; border-radius: 12px; display: flex; align-items: center; gap: 20px; border: 1px solid var(--border-color); transition: transform 0.3s ease, box-shadow 0.3s ease; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 5px 25px var(--accent-glow); }
        .stat-card .icon { font-size: 2.5rem; color: var(--accent-color); text-shadow: 0 0 10px var(--accent-glow); }
        .stat-card .info h3 { font-size: 0.9rem; opacity: 0.8; margin: 0; }
        .stat-card .info p { font-family: 'Orbitron', sans-serif; font-size: 2rem; font-weight: 900; color: var(--primary-text-color); margin: 0; }
        
        #admin-student-list table { width: 100%; border-collapse: collapse; background: transparent; }
        #admin-student-list th, #admin-student-list td { padding: 15px; text-align: right; border-bottom: 1px solid var(--border-color); }
        #admin-student-list th { font-weight: 700; background: rgba(0,0,0,0.2); }
        #admin-student-list tr:last-child td { border-bottom: none; }
        #admin-student-list tr.banned { opacity: 0.5; }
        #admin-student-list tr.banned .ban-btn { background: #28a745; }
        .action-btns { display: flex; gap: 10px; }
        .ban-btn { background: #ffc107; color: black; }
        .delete-student-btn { background: #dc3545; color: white; }
        .ban-btn, .delete-student-btn { border: none; border-radius: 6px; padding: 6px 12px; cursor: pointer; transition: opacity 0.3s ease; font-weight: 600; }
        .ban-btn:hover, .delete-student-btn:hover { opacity: 0.8; }
        
        #active-students-list { list-style: none; padding: 10px; background: var(--glass-bg); border-radius: 8px; min-height: 50px; }
        #active-students-list li { padding: 5px 0; border-bottom: 1px solid var(--border-color); }
        #active-students-list li:last-child { border-bottom: none; }

        .content-management-form { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px; }
        .content-management-form select, .content-management-form input, .content-management-form textarea { flex-grow: 1; }
        .admin-subjects-list { list-style: none; padding: 0; }
        .admin-subjects-list li { display: flex; justify-content: space-between; align-items: center; background: transparent; padding: 15px 10px; border-bottom: 1px solid var(--border-color); }
        .admin-subjects-list li:last-child { border-bottom: none; }
        .manage-btn { background: var(--accent-color); color: var(--primary-bg); border: none; border-radius: 5px; padding: 5px 10px; font-weight: 600; cursor: pointer; }
        .delete-btn { background: none; border: none; color: #ff4d4d; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; }
        .delete-btn:hover { color: #ff0000; transform: scale(1.2); }
        #admin-opinions-list .opinion-card, #admin-ratings-list .opinion-card { position: relative; background: var(--secondary-bg) }
        #admin-opinions-list .delete-btn, #admin-ratings-list .delete-btn { position: absolute; top: 10px; left: 10px; font-size: 1.2rem; }
        #content-editor-modal .modal-content { max-width: 700px; }
        .editor-section { margin-bottom: 20px; padding: 15px; background: var(--primary-bg); border-radius: 8px; }
        .editor-section h4 { margin-bottom: 15px; }
        .publish-toggle { cursor: pointer; font-size: 1.5rem; }
        .publish-toggle.published { color: var(--accent-color); }
        .publish-toggle.not-published { color: #888; }
        .setting-toggle-container { display: flex; align-items: center; justify-content: space-between; padding: 10px 0; }
        .setting-toggle-container label { font-weight: 600; }
        .toggle-switch { position: relative; display: inline-block; width: 50px; height: 26px; }
        .toggle-switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: rgba(255,255,255,0.2); transition: .4s; border-radius: 26px; }
        .slider:before { position: absolute; content: ""; height: 18px; width: 18px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--accent-color); }
        input:checked + .slider:before { transform: translateX(24px); }
        #admin-text-editor-view .input-group { margin-bottom: 15px; }
        #admin-text-editor-view details { border: 1px solid var(--border-color); border-radius: 8px; margin-bottom: 15px; overflow: hidden; }
        #admin-text-editor-view summary { padding: 15px; font-weight: 700; cursor: pointer; background: var(--glass-bg); }
        #admin-text-editor-view .details-content { padding: 15px; }
        #admin-ratings-list .rating-card-stars { color: #FFD700; }
        
        /* --- باقي التنسيقات --- */
        .scrolling-banner { width: 100%; background-color: var(--glass-bg); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); padding: 4px 0; overflow: hidden; white-space: nowrap; opacity: 0; transition: opacity 0.8s ease 0.5s; }
        #main-page.active .scrolling-banner { opacity: 1; }
        .scrolling-banner p { display: inline-block; font-size: 0.8rem; font-weight: 600; background: linear-gradient(90deg, var(--accent-hover), #e1e1ff, var(--accent-hover)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; text-fill-color: transparent; }
        #main-page.active .scrolling-banner p { animation: scroll-continuous 40s linear infinite; }
        [dir="rtl"] .scrolling-banner p, [dir="ltr"] .scrolling-banner p { padding-left: 100%; }
        @keyframes scroll-continuous { 0% { transform: translateX(-100%); } 100% { transform: translateX(100%); } }
        #main-header { width: 100%; max-width: 900px; padding: 15px 20px 25px 20px; display: flex; justify-content: space-between; align-items: center; text-align: right; position: relative; }
        [dir="ltr"] #main-header { text-align: left; }
        #main-header { animation: fadeInContent 0.8s 0.2s backwards; transition: opacity 0.4s ease; }
        #app-logo { width: 50px; height: 50px; border-radius: 50%; box-shadow: 0 0 15px var(--accent-glow); object-fit: cover; flex-shrink: 0;}
        .header-content { flex-grow: 1; padding: 0 15px; }
        #welcome-message-name { font-size: 1.2rem; font-weight: 700; }
        #welcome-message-details { font-size: 0.9rem; font-weight: 400; opacity: 0.8; margin-top: 2px; }
        #points-counter { display: flex; align-items: center; gap: 8px; background: var(--glass-bg); padding: 5px 12px; border-radius: 50px; border: 1px solid var(--border-color); font-family: 'Orbitron', sans-serif; flex-shrink: 0; cursor: pointer; transition: transform 0.3s ease; }
        #points-counter:hover { transform: scale(1.05); }
        #points-counter .fa-star { color: #FFD700; text-shadow: 0 0 8px rgba(255, 215, 0, 0.7); }
        #points-display { font-weight: 700; font-size: 1.1rem; color: var(--primary-text-color); }
        #view-wrapper { flex-grow: 1; position: relative; width: 100%; max-width: 900px; }
        #courses-container, #details-view { position: absolute; top: 0; left: 0; width: 100%; height: 100%; overflow-y: auto; padding: 20px 20px 140px 20px; overscroll-behavior: contain; }
        #courses-container { display: flex; flex-direction: column; align-items: center; gap: 15px; }
        .course-card { opacity: 0; width: 100%; max-width: 280px; background: var(--secondary-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); cursor: pointer; animation: fadeIn 0.8s forwards; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 10px; transition: border-color 0.2s ease, transform 0.2s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .course-card:hover { border-color: var(--accent-color); transform: translateY(-3px); }
        .course-card i { font-size: 1.8rem; color: var(--accent-color); margin-bottom: 5px; }
        .course-card h3 { font-size: 1.1rem; color: var(--primary-text-color); font-weight: 600; text-align: center; }
        #details-view { display: flex; flex-direction: column; }
        #details-header { display: flex; align-items: center; gap: 15px; padding-bottom: 20px; border-bottom: 1px solid var(--border-color); margin-bottom: 20px; flex-shrink: 0; }
        #back-to-courses-btn { background: transparent; border: 2px solid var(--border-color); color: var(--primary-text-color); width: 40px; height: 40px; border-radius: 50%; font-size: 1.2rem; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; justify-content: center; }
        #back-to-courses-btn:hover { border-color: var(--accent-color); color: var(--accent-color); }
        [dir="rtl"] #back-to-courses-btn i { transform: scaleX(-1); }
        #details-view-title { font-size: 1.5rem; font-weight: 700; }
        #details-view-list { display: flex; flex-direction: column; gap: 5px; }
        .detail-item { display: flex; align-items: center; justify-content: space-between; background: transparent; padding: 15px; border-radius: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); cursor: pointer; transition: all 0.2s ease; }
        .detail-item:hover { background: var(--glass-bg); }
        .detail-item span { font-size: 1.1rem; font-weight: 600; flex-grow: 1; text-align: right; }
        .detail-item .lock-icon { font-size: 1.4rem; color: var(--accent-color); margin-right: 15px; transition: transform 0.3s ease; }
        .detail-item.unlocked .lock-icon { color: #28a745; }
        @keyframes jiggle-3d-lock { 0%, 100% { transform: rotateY(0) rotateX(0); } 25% { transform: rotateY(-20deg) rotateX(10deg); } 50% { transform: rotateY(20deg) rotateX(-10deg); } 75% { transform: rotateY(-15deg); } }
        .detail-item.locked .lock-icon { animation: jiggle-3d-lock 2.5s infinite ease-in-out; text-shadow: 0 0 8px var(--accent-glow); }
        #courses-container, #details-view { transition: opacity 0.4s ease, transform 0.4s ease; }
        #details-view { opacity: 0; transform: translateY(30px); pointer-events: none; }
        #main-page.details-active #courses-container { opacity: 0; transform: translateY(-30px); pointer-events: none; }
        #main-page.details-active #details-view { opacity: 1; transform: translateY(0); pointer-events: auto; }
        #bottom-nav { position: fixed; bottom: 0; left: 0; width: 100%; z-index: 100; padding: 10px 0; background: var(--glass-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border-top: 1px solid var(--border-color); }
        .nav-group { display: flex; justify-content: space-around; align-items: center; max-width: 500px; margin: 0 auto; }
        .nav-item { cursor:pointer; display:flex; flex-direction:column; align-items:center; color:var(--primary-text-color); transition:all 0.3s ease; background: none; border: none; padding: 5px; position: relative; text-decoration: none; flex: 1; }
        .nav-item i { font-size: 1.2rem; margin-bottom: 4px; transition: color 0.2s ease, transform 0.2s ease; } 
        #courses-btn.locked .fa-lock, #meetings-btn .fa-lock { animation: jiggle-lock 2.5s infinite ease-in-out; }
        @keyframes jiggle-lock { 0%, 100% { transform: rotate(0); } 20% { transform: rotate(-8deg); } 40% { transform: rotate(8deg); } 60% { transform: rotate(-5deg); } 80% { transform: rotate(5deg); } }
        .nav-item span { font-size: 0.7rem; white-space: nowrap; }
        .nav-item:hover { color:var(--accent-hover); }
        .nav-item:active i { color: var(--accent-color); }
        .nav-item.highlight-nav-item { animation: highlight-pulse 1.5s infinite; border-radius: 8px; }
        @keyframes highlight-pulse { 0% { box-shadow: 0 0 0 0 var(--accent-glow); } 70% { box-shadow: 0 0 15px 10px rgba(0,0,0,0); } 100% { box-shadow: 0 0 0 0 rgba(0,0,0,0); } }
        .modal-overlay { position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px); z-index:1000; display:flex; justify-content:center; align-items:center; opacity:0; pointer-events:none; transition:opacity 0.4s ease; padding: 15px; }
        .modal-overlay.active { opacity:1; pointer-events:auto; }
        .modal-content { background:var(--secondary-bg); padding:30px; border-radius:12px; box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37); width:100%; max-width:550px; position:relative; border: 1px solid var(--border-color); transform:scale(0.9); transition:transform 0.4s ease; max-height: 85vh; overflow-y: auto; }
        .modal-overlay.active .modal-content { transform:scale(1); }
        .close-btn { position:absolute; top:15px; right:15px; background:none; border:none; color:var(--primary-text-color); font-size:1.8rem; cursor:pointer; transition:all 0.3s ease; text-shadow: 0 0 5px #000; z-index: 1001;}
        .close-btn:hover { color: var(--accent-color); transform: rotate(90deg); }
        .modal-overlay.full-screen { flex-direction: column; gap: 8px; overflow-y: auto; padding: 60px 15px 30px 15px; justify-content: flex-start; }
        .full-screen > .modal-content { background: transparent; border: none; box-shadow: none; padding: 0; }
        .full-screen > * { animation: fadeInContent 0.6s 0.2s backwards; }
        .full-screen .close-btn { top: 25px; right: 25px; }
        .full-screen h3 { font-size: 1.6rem; text-shadow: 0 0 10px var(--accent-glow); text-align: center; }
        .full-screen p { font-size: 1rem; opacity: 0.9; max-width: 500px; text-align: center; }
        #about-modal .modal-content { display: flex; flex-direction: column; align-items: center; padding: 30px;}
        #about-modal .modal-content > h3 { order: 1; } #about-modal .modal-content > .institute-name { order: 2; } #about-modal .modal-content > .dev-credit { order: 3; } #about-modal .modal-content > .social-icons { order: 4; margin-top: 15px; } #about-modal .modal-content > .app-version { order: 5; margin-top: 25px; } #about-modal .modal-content > .sponsors-title { order: 6; margin-top: 25px; } #about-modal .modal-content > .sponsors-list { order: 7; } #about-modal .modal-content > .modal-actions-list { order: 8; }
        #about-modal.full-screen .social-icons { display: flex; justify-content: center; align-items: center; gap: 30px; margin: 20px 0; }
        #about-modal.full-screen .social-icons a { color: var(--primary-text-color); font-size: 1.9rem; transition: color 0.3s ease, transform 0.3s ease; }
        #about-modal.full-screen .social-icons a:hover { color: var(--accent-color); transform: scale(1.1) translateY(-5px); }
        .dev-credit { font-family: 'Orbitron', sans-serif; font-size: 1.1rem; opacity: 0.9; text-shadow: 0 0 6px var(--accent-glow); }
        .institute-name { font-weight: 600; white-space: nowrap; }
        .app-version { font-family: 'Orbitron', sans-serif; font-size: 0.8rem; opacity: 0.9; background: var(--glass-bg); border: 1px solid var(--border-color); padding: 4px 12px; border-radius: 50px; display: inline-block; }
        .modal-actions-list { display: flex; flex-direction: column; gap: 15px; width: 100%; max-width: 300px; margin-top: 30px; align-items: center; }
        .modal-action-btn { display: flex; align-items: center; justify-content: center; gap: 12px; width: 100%; max-width: 260px; padding: 10px 20px; font-size: 0.95rem; font-weight: 600; border-radius: 10px; cursor: pointer; transition: all 0.3s ease; background: rgba(255, 255, 255, 0.05); border: none; text-shadow: 0 0 5px rgba(0,0,0,0.5); }
        .modal-action-btn:hover { transform: translateY(-4px) scale(1.03); background: rgba(255, 255, 255, 0.1); }
        .modal-action-btn i { color: inherit !important; }
        #rate-website-btn { color: var(--accent-color); } #blog-btn { color: #c37cff; } #privacy-policy-btn { color: #49e3c0; } #timer-btn { color: #f37b12; } #logout-btn, #clear-data-btn { color: #ff4d4d; }
        #rate-website-btn:hover { text-shadow: 0 0 10px var(--accent-glow); } #blog-btn:hover { text-shadow: 0 0 10px rgba(195, 124, 255, 0.6); } #privacy-policy-btn:hover { text-shadow: 0 0 10px rgba(73, 227, 192, 0.6); } #timer-btn:hover { text-shadow: 0 0 10px rgba(243, 123, 18, 0.6); } #logout-btn:hover, #clear-data-btn:hover { text-shadow: 0 0 10px rgba(255, 77, 77, 0.6); }
        .sponsors-title { font-size: 1.2rem; font-weight: 700; color: var(--accent-color); margin-bottom: 15px; margin-top: 15px; text-shadow: 0 0 8px var(--accent-glow); }
        .sponsors-list { list-style: none; padding: 0; margin: 0 0 20px 0; line-height: 1.8; font-size: 1.1rem; text-align: center; }
        .glowing-sponsors li { font-weight: 600; color: #fff; padding-bottom: 10px; margin-bottom: 10px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); animation: pulse-glow 3s infinite alternate, fadeInSponsor 0.6s backwards; transition: transform 0.3s ease, text-shadow 0.3s ease; }
        .glowing-sponsors li:last-child { border-bottom: none; margin-bottom: 0; }
        .glowing-sponsors li:hover { transform: scale(1.05); text-shadow: 0 0 10px #fff, 0 0 20px var(--accent-color), 0 0 35px var(--accent-color); }
        .glowing-sponsors.animate li:nth-child(1) { animation-delay: 0.5s; } .glowing-sponsors.animate li:nth-child(2) { animation-delay: 0.7s; } .glowing-sponsors.animate li:nth-child(3) { animation-delay: 0.9s; }
        @keyframes fadeInSponsor { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        @keyframes pulse-glow { from { text-shadow: 0 0 4px #fff, 0 0 8px var(--accent-glow), 0 0 12px var(--accent-glow); } to { text-shadow: 0 0 8px #fff, 0 0 16px var(--accent-color), 0 0 24px var(--accent-color); } }
        #ai-modal.full-screen .ai-container, #platform-links-modal.full-screen .ai-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 12px; width: 100%; max-width: 900px; padding: 20px 5px; }
        .ai-btn { display: flex; align-items: center; justify-content: center; padding: 12px 8px; background: rgba(255, 255, 255, 0.08); border: 1px solid var(--border-color); color: var(--primary-text-color); text-align: center; text-decoration: none; border-radius: 10px; font-size: 0.9rem; font-weight: 600; transition: all 0.3s ease; min-height: 60px; }
        .ai-btn:hover { border-color: var(--accent-color); background: rgba(0,0,0, 0.2); transform: translateY(-3px); color: var(--accent-color); }
        #redirect-modal.full-screen { gap: 10px; text-align: center; justify-content: center; }
        #redirect-modal .dev-text { font-size: 1rem; opacity: 0.8; }
        #redirect-modal .redirect-message { font-size: 1.5rem; font-weight: 600; }
        #redirect-modal #redirect-timer { font-family: 'Orbitron', sans-serif; font-size: 4rem; font-weight: 700; color: var(--accent-color); text-shadow: 0 0 20px var(--accent-glow); animation: timerPulse 1s infinite; }
        @keyframes timerPulse { 50% { transform: scale(1.1); } }
        #settings-modal .modal-content { background: transparent; box-shadow: none; border: none; padding: 30px;}
        .settings-section { margin-bottom: 25px; }
        .settings-section h4 { padding-bottom: 8px; margin-bottom: 12px; border-bottom: 1px solid var(--border-color); opacity: 0.9; font-weight: 700; }
        .settings-options.vertical-options { display: flex; flex-direction: column; gap: 10px; margin-top: 10px; }
        .vertical-options .settings-btn {  width: 100%; padding: 12px; text-align: right; border: 1px solid var(--border-color); border-radius: 8px; background: transparent; transition: all 0.2s ease; color: var(--primary-text-color); text-shadow: 0 0 4px rgba(0, 0, 0, 0.7); }
        [dir="ltr"] .vertical-options .settings-btn { text-align: left; }
        .vertical-options .settings-btn:hover { border-color: var(--accent-color); background: var(--primary-bg); }
        .vertical-options .settings-btn.active { border-color: var(--accent-color); background-color: var(--glass-bg); font-weight: bold; color: var(--accent-color); text-shadow: 0 0 8px var(--accent-glow); }
        #theme-switcher { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 10px; margin-top: 10px; }
        .theme-btn { display: flex; align-items: center; gap: 12px; padding: 10px; background-color: var(--glass-bg); color: var(--primary-text-color); border: 1px solid transparent; border-radius: 8px; width: 100%; font-size: 1rem; cursor: pointer; transition: all 0.2s ease; }
        .theme-btn:hover { border-color: var(--accent-color); background: var(--primary-bg); }
        .theme-btn.active { border-color: var(--accent-color); font-weight: bold; }
        .theme-swatch { width: 20px; height: 20px; border-radius: 50%; flex-shrink: 0; }
        #privacy-modal .modal-content { background: transparent; box-shadow: none; border: none; max-width: 600px; text-align: center;}
        #privacy-modal h3 { font-size: 1.6rem; text-shadow: 0 0 10px var(--accent-glow); }
        #privacy-modal p { line-height: 1.7; opacity: 0.9; margin-bottom: 15px; text-shadow: 0 1px 5px rgba(0,0,0,0.8); }
        .rating-stars { font-size: 2rem; color: var(--accent-color); padding: 20px 0; cursor: pointer; }
        .rating-stars i { margin: 0 3px; transition: transform 0.2s ease, color 0.2s; }
        .rating-stars i:hover { transform: scale(1.2); }
        #blog-modal .modal-content { display: flex; flex-direction: column; }
        #blog-textarea { width: 100%; height: 250px; background-color: var(--primary-bg); border: 1px solid var(--border-color); color: var(--primary-text-color); border-radius: 8px; padding: 15px; font-size: 1rem; resize: vertical; margin-top: 15px; transition: all 0.3s ease; }
        #blog-textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 10px var(--accent-glow); }
        .blog-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 15px; }
        #char-counter { font-size: 0.8rem; opacity: 0.7; }
        #save-blog-btn { padding: 8px 25px; background: var(--accent-color); color: #05080f; border: none; border-radius: 50px; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        #save-blog-btn:hover { background: var(--accent-hover); transform: scale(1.05); }
        #save-blog-btn.saved { background-color: #28a745; }
        
        /* === CINEMATIC & TRANSPARENT TIMER STYLES === */
        #timer-modal.modal-overlay { background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); -webkit-backdrop-filter: blur(5px); }
        #timer-modal .modal-content { background: transparent; box-shadow: none; border: none; transform: none; transition: none; padding: 0; }
        #timer-container { text-align: center; max-width: 380px; position: relative; background: transparent; padding: 20px; border-radius: 15px; opacity: 0; animation: cinematic-timer-fade-in 0.6s 0.1s cubic-bezier(0.165, 0.84, 0.44, 1) forwards; }
        #timer-modal.active #timer-container { opacity: 1; }
        @keyframes cinematic-timer-fade-in { from { opacity: 0; transform: translateY(40px) scale(0.9); } to { opacity: 1; transform: translateY(0) scale(1); } }
        #timer-modal .close-btn { z-index: 5; }
        #timer-display { font-family: 'Orbitron', sans-serif; font-size: 4.5rem; font-weight: 700; text-shadow: 0 0 25px var(--accent-glow), 0 0 40px var(--accent-glow); margin: 0; transition: color 0.5s ease, text-shadow 0.5s ease; }
        #pomodoro-info { margin-top: 5px; margin-bottom: 25px; text-shadow: 0 1px 4px #000; }
        #pomodoro-mode { font-size: 1.2rem; font-weight: 600; opacity: 0.9; }
        #pomodoro-cycles { font-size: 0.9rem; opacity: 0.7; }
        #pomodoro-desc { font-size: 0.85rem; opacity: 0.7; max-width: 300px; margin: 25px auto 0 auto; line-height: 1.6; }
        #timer-container.work-mode #timer-display { color: var(--accent-color); }
        #timer-container.break-mode #timer-display { color: #4C82F7; text-shadow: 0 0 25px rgba(76, 130, 247, 0.6), 0 0 40px rgba(76, 130, 247, 0.5); }
        #timer-controls { display: flex; justify-content: center; gap: 20px; }
        #timer-controls button { padding: 12px 30px; font-size: 1.1rem; font-weight: 600; border: 2px solid var(--border-color); color: var(--primary-text-color); background: transparent; border-radius: 50px; cursor: pointer; transition: all 0.3s ease; min-width: 120px; }
        #timer-controls button:hover { border-color: var(--accent-color); color: var(--accent-color); box-shadow: 0 0 15px -5px var(--accent-glow); }
        #timer-controls button#start-pause-timer-btn.running { background: var(--accent-color); color: #05080f; border-color: var(--accent-color); }
        
        /* === BACKGROUND TIMER & POINTS INFO STYLES === */
        #timer-live-indicator { position: absolute; top: 20px; left: 20px; width: 10px; height: 10px; background-color: #ff4d4d; border-radius: 50%; box-shadow: 0 0 8px #ff4d4d, 0 0 12px #ff4d4d, 0 0 4px #fff; display: none; animation: pulse-live 1.5s infinite; z-index: 101; }
        #timer-live-indicator.active { display: block; }
        @keyframes pulse-live { 0% { transform: scale(0.9); opacity: 0.8; } 50% { transform: scale(1.2); opacity: 1; } 100% { transform: scale(0.9); opacity: 0.8; } }
        
        #timer-live-text { position: absolute; top: 18px; left: 35px; font-family: 'Orbitron', sans-serif; font-size: 0.7rem; font-weight: 700; color: #ff4d4d; text-shadow: 0 0 5px #ff4d4d; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; z-index: 102; }
        #timer-live-text.active { opacity: 0.9; }

        #points-info-toast { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.9); background: var(--glass-bg); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); border: 1px solid var(--border-color); box-shadow: 0 4px 30px rgba(0, 0, 0, 0.3); color: var(--primary-text-color); padding: 20px 25px; border-radius: 15px; text-align: center; z-index: 2000; opacity: 0; pointer-events: none; transition: opacity 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); width: 90%; max-width: 450px; }
        #points-info-toast .close-toast-btn { position: absolute; top: 8px; right: 8px; background: none; border: none; font-size: 1.8rem; color: var(--primary-text-color); cursor: pointer; transition: all 0.3s ease; opacity: 0.7; line-height: 1; }
        #points-info-toast .close-toast-btn:hover { color: var(--accent-color); transform: scale(1.1); opacity: 1; }
        #points-info-toast.show { opacity: 1; transform: translate(-50%, -50%) scale(1); pointer-events: auto; }
        #points-info-toast .points-info-main-text { font-size: 1.2rem; font-weight: 600; line-height: 1.7; text-shadow: 0 1px 3px rgba(0,0,0,0.5); margin: 0; }
        #points-info-toast .highlight { color: var(--accent-color); font-family: 'Orbitron', sans-serif; text-shadow: 0 0 10px var(--accent-glow); }
        #points-info-toast .dev-credit-toast { display: block; margin-top: 15px; font-family: 'Orbitron', sans-serif; font-size: 0.9rem; color: var(--accent-hover); opacity: 0.8; text-shadow: 0 0 8px var(--accent-glow); }
        #pointing-arrow { position: fixed; z-index: 2001; width: 30px; height: 30px; opacity: 0; pointer-events: none; transform: translateX(-50%); transition: opacity 0.4s ease; }
        #pointing-arrow::before { content: ''; position: absolute; top: 0; left: 50%; width: 100%; height: 100%; border-left: 4px solid var(--accent-color); border-bottom: 4px solid var(--accent-color); transform: translateX(-50%) rotate(-45deg); box-shadow: -2px 2px 5px var(--accent-glow); }
        #pointing-arrow.show { opacity: 1; animation: point-bounce 1.5s infinite ease-in-out; }
        @keyframes point-bounce { 0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); } 40% { transform: translateX(-50%) translateY(15px); } 60% { transform: translateX(-50%) translateY(7px); } }
        
        /* === OPINIONS MODAL STYLES === */
        #opinions-modal .modal-content { display: flex; flex-direction: column; height: 100%; }
        #opinions-list { flex-grow: 1; overflow-y: auto; padding: 20px 10px; display: flex; flex-direction: column; gap: 15px; }
        .opinion-card { background: var(--glass-bg); padding: 15px; border-radius: 12px; border: 1px solid var(--border-color); opacity: 0; animation: fadeInUpCard 0.6s forwards; }
        .opinion-card-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px; padding-bottom: 8px; border-bottom: 1px solid var(--border-color); gap: 10px;}
        .opinion-author-details { display: flex; flex-direction: column; align-items: flex-start; }
        .opinion-author { font-weight: 700; color: var(--accent-color); text-shadow: 0 0 5px var(--accent-glow); }
        .opinion-meta { font-size: 0.75rem; opacity: 0.6; }
        .opinion-timestamp { font-size: 0.75rem; opacity: 0.7; flex-shrink: 0; }
        .opinion-text { font-size: 0.95rem; line-height: 1.7; opacity: 0.9; word-wrap: break-word; }
        #opinion-form-container { padding: 15px; background: var(--secondary-bg); border-top: 1px solid var(--border-color); flex-shrink: 0; }
        #opinion-textarea { width: 100%; height: 80px; background: var(--primary-bg); border: 1px solid var(--border-color); border-radius: 8px; padding: 10px; color: var(--primary-text-color); font-size: 1rem; resize: vertical; margin-bottom: 10px; }
        #opinion-textarea:focus { outline: none; border-color: var(--accent-color); box-shadow: 0 0 10px var(--accent-glow); }
        #submit-opinion-btn { width: 100%; padding: 10px; background: var(--accent-color); color: #05080f; border: none; border-radius: 8px; font-weight: 700; font-size: 1.1rem; cursor: pointer; transition: all 0.3s ease; }
        #submit-opinion-btn:hover { background: var(--accent-hover); transform: scale(1.02); }
        

        #points-notification { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: transparent; color: var(--accent-color); font-size: 3.5rem; font-weight: 700; z-index: 2000; opacity: 0; pointer-events: none; text-shadow: 0 0 10px var(--accent-glow), 0 0 20px var(--accent-glow), 0 0 45px #fff; }
        #points-notification.show { animation: cinematic-points 2.2s ease-out forwards; }
        @keyframes cinematic-points { 0% { opacity: 0; transform: translate(-50%, -50%) scale(0.5); } 20% { opacity: 1; transform: translate(-50%, -60%) scale(1.1); } 80% { opacity: 1; transform: translate(-50%, -65%) scale(1.1); } 100% { opacity: 0; transform: translate(-50%, -75%) scale(1.2); } }
        #lecture-content-modal .modal-content, #courses-locked-modal .modal-content { background: transparent; box-shadow: none; border: none; text-align: center; padding: 30px;}
        #courses-locked-message { font-size: 1.5rem; font-weight: 600; line-height: 1.7; text-shadow: 0 2px 10px rgba(0,0,0,0.9); max-width: 480px; }
        #courses-locked-message .highlight { color: var(--accent-color); font-weight: 700; font-family: 'Orbitron', sans-serif; text-shadow: 0 0 15px var(--accent-glow); }
        .dev-credit-modal { margin-top: 25px; font-family: 'Orbitron', sans-serif; font-size: 1.1rem; color: var(--accent-hover); text-shadow: 0 0 8px var(--accent-glow), 0 1px 4px #000; opacity: 0.9; }
        
        #lecture-content { line-height: 1.9; text-shadow: 0 2px 10px rgba(0,0,0,0.9); padding: 0 15px; }
        #lecture-content h3 { color: var(--accent-color); margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--border-color); font-size: 1.8rem; text-shadow: 0 0 15px var(--accent-glow), 0 0 5px rgba(0,0,0,0.7); }
        #lecture-content p { opacity: 0.9; margin-bottom: 15px; font-size: 1.1rem; word-break: break-word; }
        #video-player-modal .modal-content { background: var(--secondary-bg); box-shadow: 0 0 25px rgba(0,0,0,0.5); border: 1px solid var(--border-color); max-width: 800px; padding: 20px; }
        #video-player-container { position: relative; width: 100%; height: 0; padding-bottom: 56.25%; }
        #video-player-container iframe { position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 8px; }

        @keyframes fadeInUpCard { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        
        @media (min-width: 768px) {
            #courses-container { flex-direction: row; flex-wrap: wrap; justify-content: center; gap: 25px; max-width: 800px; margin: 0 auto; }
            .course-card { width: 300px; max-width: 300px; box-shadow: 0 0 15px -2px var(--accent-glow); border: 1px solid var(--border-color); border-radius: 12px; transition: transform 0.3s ease, box-shadow 0.3s ease; animation: fadeInUpCard 0.6s forwards; }
            .course-card:hover { transform: translateY(-5px) scale(1.03); box-shadow: 0 0 25px 0px var(--accent-color); }
        }
        @media (max-width: 480px) { #welcome-message-name { font-size: 1rem; } #welcome-message-details { font-size: 0.8rem; } .institute-name { font-size: 0.9rem; } #points-notification { font-size: 2.8rem; } }
        @media (max-width: 360px) { .nav-item span { font-size: 0.6rem; } #timer-display { font-size: 3.5rem; } #timer-controls button { padding: 10px 20px; font-size: 1rem; min-width: 100px; } .header-content { padding: 0 10px; } #welcome-message-name { font-size: 0.9rem; } #welcome-message-details { font-size: 0.75rem; } }
    </style>
</head>
<body>
    <div class="animated-bg">
        <canvas id="login-animation-canvas"></canvas>
        <div class="glow-element" id="glow1"></div>
        <div class="glow-element" id="glow2"></div>
    </div>
    
    <div id="loading-page" class="page">
        <div class="loading-container">
            <div class="loading-spinner">
                <svg class="progress-ring" width="120" height="120">
                   <circle class="progress-ring__circle-bg" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/>
                   <circle class="progress-ring__circle" stroke-width="6" fill="transparent" r="54" cx="60" cy="60"/>
                </svg>
                <img src="https://i.postimg.cc/BnLgYqwX/IMG-20250414-WA0047-1.jpg" alt="Mora Logo" class="loading-logo">
            </div>
            <p class="loading-text" data-key="loading_text">متنساش تصلي علي النبي</p>
            <p id="wait-message">... من فضلك انتظر</p>
        </div>
    </div>
    
    <div id="login-page" class="page">
        <div class="auth-choice-container" id="auth-choice-view">
            <div class="login-header">
                <img src="https://i.postimg.cc/BnLgYqwX/IMG-20250414-WA0047-1.jpg" alt="Mora Logo">
                <p class="welcome-text">Welcome to Mora for Studying</p>
            </div>
            <button class="auth-btn" id="create-account-choice-btn" data-key="create_account_btn">إنشاء حساب</button>
            <button class="auth-btn" id="login-choice-btn" data-key="login_choice_btn">تسجيل الدخول</button>
        </div>

        <div class="auth-view" id="create-account-view">
            <button class="back-to-choice-btn" title="رجوع"><i class="fas fa-arrow-right"></i></button>
            <form id="create-account-form" class="auth-form" novalidate>
                <h1 class="auth-title" data-key="create_account_title">إنشاء حساب جديد</h1>
                <div class="input-group">
                    <input type="text" id="create-name" required placeholder=" ">
                    <label for="create-name" data-key="name_placeholder">الاسم</label>
                </div>
                <div class="input-group">
                    <select id="year" required>
                        <option value="" disabled selected data-key="year_placeholder">الفرقة</option>
                        <option value="1" data-key="year_1">الأولى</option>
                        <option value="2" data-key="year_2">الثانية</option>
                        <option value="3" data-key="year_3">الثالثة</option>
                        <option value="4" data-key="year_4">الرابعة</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="major" required>
                        <option value="" disabled selected data-key="major_placeholder">اختر الفرقة أولاً...</option>
                    </select>
                </div>
                <div class="input-group">
                    <select id="semester" required>
                        <option value="1" data-key="semester_1">الفصل الدراسي الأول</option>
                        <option value="2" data-key="semester_2">الفصل الدراسي الثاني</option>
                    </select>
                </div>
                <div class="input-group">
                    <div class="password-wrapper">
                         <input type="password" id="create-password" required minlength="8" placeholder=" " autocomplete="new-password"/>
                         <label for="create-password" data-key="password_label">كلمة السر</label>
                         <i class="fas fa-eye password-toggle"></i>
                    </div>
                </div>
                <p class="password-hint" data-key="password_format_hint">يجب أن لا تقل عن 8 حروف وتحتوي على أحرف وأرقام.</p>
                
                <div class="captcha-container-numeric">
                    <canvas id="captcha-canvas" width="120" height="40"></canvas>
                    <button type="button" id="captcha-refresh-btn" title="تحديث الرمز"><i class="fas fa-sync-alt"></i></button>
                    <div class="input-group">
                        <input type="text" id="captcha-input" required placeholder=" " autocomplete="off">
                        <label for="captcha-input" data-key="captcha_enter_code">أدخل الرمز</label>
                    </div>
                </div>
                <div id="semester-warning"></div>
                 <button type="submit" form="create-account-form" class="submit-btn" data-key="register_btn">سجل الآن</button>
                 <input type="hidden" id="create-country">
                 <input type="hidden" id="create-governorate">
            </form>
        </div>
        
        <div class="auth-view" id="login-view">
             <button class="back-to-choice-btn" title="رجوع"><i class="fas fa-arrow-right"></i></button>
             <form id="login-form" class="auth-form" novalidate>
                 <h1 class="auth-title" data-key="login_title_main">تسجيل الدخول</h1>
                 <div class="input-group">
                     <input type="text" id="login-name" required placeholder=" ">
                     <label for="login-name" data-key="name_placeholder">الاسم</label>
                 </div>
                 <div class="input-group">
                    <div class="password-wrapper">
                         <input type="password" id="login-password" required placeholder=" "/>
                         <label for="login-password" data-key="password_label">كلمة السر</label>
                         <i class="fas fa-eye password-toggle"></i>
                    </div>
                 </div>
                 <p class="password-hint" data-key="password_forgot_hint" style="text-align: center; margin-top: 5px; margin-bottom: 5px; width: 100%;">يجب عليك عدم نسيان كلمه السر</p>
                 <button type="submit" form="login-form" class="submit-btn" data-key="login_btn_main">دخول</button>
             </form>
        </div>
    </div>
    
    <div id="auth-message"></div>

    <div id="main-page" class="page">
        <div class="scrolling-banner">
            <p></p>
        </div>

        <header id="main-header">
            <div id="timer-live-indicator"></div>
            <p id="timer-live-text" data-key="timer_live_text">جارٍ الآن</p>
            <div id="points-counter">
                <i class="fas fa-star"></i>
                <span id="points-display">0</span>
            </div>
            <div class="header-content">
                <p id="welcome-message-name"></p>
                <p id="welcome-message-details"></p>
            </div>
            <img src="https://i.postimg.cc/gjS04rJw/IMG-20250414-WA0047.jpg" alt="App Logo" id="app-logo">
        </header>
        <div id="view-wrapper">
            <div id="courses-container"></div>
            <div id="details-view">
                <div id="details-header"><button id="back-to-courses-btn" title="Back"><i class="fas fa-arrow-right"></i></button><h3 id="details-view-title"></h3></div>
                <div id="details-view-list"></div>
            </div>
        </div>
        <nav id="bottom-nav">
            <div class="nav-group">
                <button class="nav-item" onclick="showContentListForType('pdfs')"><i class="fas fa-file-pdf"></i><span data-key="nav_pdf">كتب</span></button>
                <button class="nav-item" id="meetings-btn"><i class="fas fa-lock"></i><span data-key="nav_meetings">ميتنج</span></button>
                <button class="nav-item" onclick="showContentListForType('sections')"><i class="fas fa-layer-group"></i><span data-key="nav_sections">السكاشن</span></button>
                <button class="nav-item" data-modal="ai-modal"><i class="fas fa-robot"></i><span data-key="nav_ai">AI</span></button>
                <button class="nav-item" id="platform-btn"><i class="fas fa-university"></i><span data-key="nav_platform">المنصة</span></button>
                <button class="nav-item" id="courses-btn"><i id="courses-icon" class="fas fa-lock"></i><span data-key="nav_courses">كورسات</span></button>
                <button class="nav-item" data-modal="opinions-modal"><i class="fas fa-comments"></i><span data-key="nav_opinions">آراء الطلاب</span></button>
                <button class="nav-item" data-modal="about-modal"><i class="fas fa-info-circle"></i><span data-key="nav_about">عنا</span></button>
                <button class="nav-item" data-modal="settings-modal"><i class="fas fa-sliders-h"></i><span data-key="nav_settings">الإعدادات</span></button>
            </div>
        </nav>
    </div>

    <div id="admin-panel" class="page">
        <div class="admin-container">
            <aside class="admin-sidebar">
                <h1 id="admin-site-name-header">Mora Admin</h1>
                <ul class="admin-nav">
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link active" data-view="dashboard"><i class="fas fa-tachometer-alt"></i><span>لوحة المعلومات</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="students"><i class="fas fa-users"></i><span>إدارة الطلاب</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="content-lectures"><i class="fas fa-chalkboard-teacher"></i><span>إدارة المحاضرات</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="content-pdfs"><i class="fas fa-book-open"></i><span>إدارة الكتب</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="content-sections"><i class="fas fa-users-cog"></i><span>إدارة السكاشن</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="opinions"><i class="fas fa-comments"></i><span>إدارة الآراء</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="ratings"><i class="fas fa-star-half-alt"></i><span data-key="nav_ratings_admin">تقييمات الموقع</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="announcements"><i class="fas fa-bullhorn"></i><span data-key="nav_announcements">الإعلانات</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="text-editor"><i class="fas fa-language"></i><span data-key="nav_text_editor">إدارة نصوص الموقع</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="ai-tools"><i class="fas fa-robot"></i><span data-key="nav_ai_tools_admin">إدارة أدوات AI</span></a></li>
                    <li class="admin-nav-item"><a href="#" class="admin-nav-link" data-view="site-settings"><i class="fas fa-cogs"></i><span data-key="nav_site_settings">إعدادات الموقع</span></a></li>
                </ul>
                <button id="admin-logout-btn" class="modal-action-btn" data-key="logout_btn"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
            </aside>
            <main class="admin-main-content">
                <div id="admin-dashboard-view" class="admin-view active">
                    <h2>لوحة المعلومات</h2>
                    <div class="stats-container">
                        <div class="stat-card">
                            <i class="fas fa-users icon"></i>
                            <div class="info">
                                <h3>إجمالي الطلاب</h3>
                                <p id="student-count">0</p>
                            </div>
                        </div>
                         <div class="stat-card">
                            <i class="fas fa-comment-dots icon"></i>
                            <div class="info">
                                <h3>إجمالي الآراء</h3>
                                <p id="opinions-count">0</p>
                            </div>
                        </div>
                         <div class="stat-card">
                            <i class="fas fa-book icon"></i>
                            <div class="info">
                                <h3>إجمالي المواد</h3>
                                <p id="subjects-count">0</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-star icon"></i>
                            <div class="info">
                                <h3>الطالب الأكثر نشاطًا</h3>
                                <p id="top-student" style="font-size: 1.2rem; font-family: 'Cairo', sans-serif;">-</p>
                            </div>
                        </div>
                    </div>
                    <div style="margin-top: 30px;">
                        <h3><i class="fas fa-users-slash" style="color:var(--accent-color)"></i> الطلاب النشطون حاليًا (آخر 5 دقائق)</h3>
                        <ul id="active-students-list"></ul>
                    </div>
                </div>

                <div id="admin-students-view" class="admin-view">
                    <h2>إدارة الطلاب</h2>
                    <div id="admin-student-list" style="overflow-x: auto;"></div>
                </div>

                <div id="admin-content-lectures-view" class="admin-view">
                    <h2>إدارة المحاضرات</h2>
                    <div class="content-view-container"></div>
                </div>
                <div id="admin-content-pdfs-view" class="admin-view">
                    <h2>إدارة الكتب</h2>
                    <div class="content-view-container"></div>
                </div>
                <div id="admin-content-sections-view" class="admin-view">
                    <h2>إدارة السكاشن</h2>
                    <div class="content-view-container"></div>
                </div>

                <div id="admin-opinions-view" class="admin-view">
                    <h2>إدارة آراء الطلاب</h2>
                    <div id="admin-opinions-list"></div>
                </div>

                <div id="admin-ratings-view" class="admin-view">
                     <h2>تقييمات الموقع</h2>
                     <div id="admin-ratings-list"></div>
                </div>
                
                <div id="admin-announcements-view" class="admin-view">
                    <h2>إرسال إعلان للطلاب</h2>
                    <form id="announcement-form">
                        <div class="input-group">
                            <textarea id="announcement-textarea" placeholder=" " required style="height: 120px;"></textarea>
                            <label for="announcement-textarea">نص الإعلان</label>
                        </div>
                        <button type="submit" class="submit-btn" style="font-size: 1.1rem; padding: 12px; margin-top: 10px;">إرسال الإعلان</button>
                    </form>
                    <div style="margin-top: 20px;">
                        <h4>الإعلان الحالي:</h4>
                        <p id="current-announcement" style="opacity: 0.8;">لا يوجد إعلان حالي.</p>
                    </div>
                </div>

                 <div id="admin-text-editor-view" class="admin-view">
                     <h2>إدارة نصوص الموقع (العربية)</h2>
                     <form id="text-editor-form"></form>
                 </div>
                 
                 <div id="admin-ai-tools-view" class="admin-view">
                     <h2>إدارة أدوات الذكاء الاصطناعي</h2>
                     <div id="admin-ai-tools-list" class="details-view-list" style="margin-bottom: 20px;"></div>
                     <form id="add-ai-tool-form" class="content-management-form" style="flex-direction:column; gap: 15px; margin-top: 15px;">
                        <h4>إضافة أداة جديدة</h4>
                        <div class="input-group"><input type="text" id="new-ai-tool-name" placeholder=" " required><label>اسم الأداة</label></div>
                        <div class="input-group"><input type="url" id="new-ai-tool-url" placeholder=" " required><label>رابط الأداة</label></div>
                        <button type="submit" class="submit-btn" style="font-size: 1rem; padding: 10px; margin-top: 0;">إضافة أداة</button>
                    </form>
                 </div>

                <div id="admin-site-settings-view" class="admin-view">
                    <h2>إعدادات الموقع</h2>
                    <form id="site-settings-form">
                        <div class="input-group">
                            <input type="text" id="setting-site-name" placeholder=" " required>
                            <label for="setting-site-name">اسم الموقع</label>
                        </div>
                        <hr style="border-color: var(--border-color); margin: 20px 0;">
                        <div class="setting-toggle-container">
                            <label for="setting-courses-unlocked">تفعيل قسم الكورسات للجميع (تجاوز النقاط)</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-courses-unlocked">
                                <span class="slider"></span>
                            </label>
                        </div>
                         <div class="setting-toggle-container">
                            <label for="setting-meetings-unlocked">تفعيل قسم الميتنج</label>
                            <label class="toggle-switch">
                                <input type="checkbox" id="setting-meetings-unlocked">
                                <span class="slider"></span>
                            </label>
                        </div>
                        <div class="input-group" id="meeting-url-container" style="display: none;">
                            <input type="url" id="setting-meeting-url" placeholder=" ">
                            <label for="setting-meeting-url">رابط الميتنج (Zoom, etc.)</label>
                        </div>
                        <hr style="border-color: var(--border-color); margin: 20px 0;">
                        <div class="input-group">
                            <input type="number" id="setting-points-unlock" placeholder=" " required>
                            <label for="setting-points-unlock">النقاط المطلوبة لفتح الكورسات</label>
                        </div>
                        <div class="input-group">
                            <input type="number" id="setting-points-lecture" placeholder=" " required>
                            <label for="setting-points-lecture">النقاط لكل محاضرة</label>
                        </div>
                        <div class="input-group">
                            <textarea id="setting-banner-text" placeholder=" " style="height: 80px;"></textarea>
                            <label for="setting-banner-text">نص البانر المتحرك</label>
                        </div>
                        <button type="submit" class="submit-btn" style="font-size: 1.1rem; padding: 12px; margin-top: 10px;">حفظ الإعدادات</button>
                    </form>
                </div>
            </main>
        </div>
    </div>
    
    <div id="points-notification">+9 نقاط</div>
    <div id="settings-modal" class="modal-overlay"><div class="modal-content"><button class="close-btn">×</button><h3 data-key="settings_title">الإعدادات</h3><div class="settings-section"><h4 data-key="settings_theme">الثيم اللوني</h4><div id="theme-switcher"></div></div><div class="settings-section"><h4 data-key="settings_lang">اللغة</h4><div class="settings-options vertical-options" id="lang-switcher"><button class="settings-btn" data-lang="ar">العربية</button><button class="settings-btn" data-lang="en">English</button></div></div><div class="settings-section"><h4 data-key="settings_mode">الوضع</h4><div class="settings-options vertical-options" id="mode-switcher"><button class="settings-btn" data-mode="mode-dark" data-key="mode_dark">داكن</button><button class="settings-btn" data-mode="mode-light" data-key="mode_light">فاتح</button><button class="settings-btn" data-mode="mode-oled" data-key="mode_oled">ليلي</button><button class="settings-btn" data-mode="mode-gold-black" data-key="mode_gold_black">ذهبي</button></div></div></div></div>
    <div id="privacy-modal" class="modal-overlay"><div class="modal-content"><button class="close-btn">×</button><h3 data-key="privacy_title">سياسة الخصوصية</h3><p data-key="privacy_content"></p></div></div>
    <div id="about-modal" class="modal-overlay full-screen">
        <div class="modal-content">
            <button class="close-btn">×</button>
            <h3 data-key="about_title">Mora for Studying</h3>
            <p class="institute-name" data-key="about_desc"></p>
            <p class="dev-credit" data-key="about_dev"></p>
            <div class="social-icons">
                <a href="https://www.instagram.com/eltopamr55?igsh=MWJ2MzJqaXBlZzRlaQ==" target="_blank" title="Instagram"><i class="fab fa-instagram"></i></a>
                <a href="mailto:amrloutfy2006@gmail.com" title="Email"><i class="fas fa-envelope"></i></a>
                <a href="https://wa.me/201067941806" target="_blank" title="WhatsApp"><i class="fab fa-whatsapp"></i></a>
            </div>
            <p class="app-version" data-key="app_version"></p>
            <h4 class="sponsors-title" data-key="sponsors_title">تحت رعاية</h4>
            <ul class="sponsors-list glowing-sponsors">
                <li>أ. د/ عبدالمنعم الدسوقي</li>
                <li>أ. د/ إبراهيم ماريه</li>
                <li>أ. د/ مصطفى عبدالمنعم</li>
            </ul>
            <div class="modal-actions-list">
                <button id="rate-website-btn" class="modal-action-btn" data-modal="rating-modal" data-key="rate_website_btn"><i class="fas fa-star"></i> قيم الموقع</button>
                <button id="blog-btn" class="modal-action-btn" data-modal="blog-modal" data-key="blog_btn" style="display: none;"><i class="fas fa-feather-alt"></i> مدونتي</button>
                <button id="timer-btn" class="modal-action-btn" data-modal="timer-modal" data-key="timer_btn"><i class="fas fa-stopwatch"></i> تايمر</button>
                <button id="privacy-policy-btn" class="modal-action-btn" data-modal="privacy-modal" data-key="privacy_policy_btn"><i class="fas fa-shield-alt"></i> سياسة الخصوصية</button>
                <button id="logout-btn" class="modal-action-btn" data-key="logout_btn"><i class="fas fa-sign-out-alt"></i> تسجيل الخروج</button>
                <button id="clear-data-btn" class="modal-action-btn" data-key="clear_data_btn"><i class="fas fa-trash-alt"></i> محو البيانات</button>
            </div>
        </div>
    </div>
    <div id="ai-modal" class="modal-overlay full-screen"><div class="modal-content"><button class="close-btn">×</button><h3 data-key="ai_title">اختر مساعدك الذكي</h3><div class="ai-container"></div></div></div>
    <div id="platform-links-modal" class="modal-overlay full-screen"><div class="modal-content"><button class="close-btn">×</button><h3 data-key="platform_title">روابط المنصة التعليمية</h3><div class="ai-container"><a href="https://tanta-services.online/TantaPortal/index.php" class="ai-btn" target="_blank">بوابة خدمات المعهد</a></div></div></div>
    <div id="redirect-modal" class="modal-overlay full-screen"><div class="modal-content"><p class="dev-text" data-key="redirect_dev">تم التطوير بواسطة Amr Lotfy</p><h3 class="redirect-message" data-key="redirect_msg">...جاري تحويلك الآن</h3><div id="redirect-timer">3</div></div></div>
    <div id="rating-modal" class="modal-overlay"><div class="modal-content" style="text-align: center;"><button class="close-btn">×</button><h3 data-key="rating_title">قيم تجربتك</h3><div class="rating-stars"><i class="far fa-star" data-value="1"></i><i class="far fa-star" data-value="2"></i><i class="far fa-star" data-value="3"></i><i class="far fa-star" data-value="4"></i><i class="far fa-star" data-value="5"></i></div></div></div>
    <div id="blog-modal" class="modal-overlay"><div class="modal-content"><button class="close-btn">×</button><h3 data-key="blog_title">مدونتي الشخصية</h3><textarea id="blog-textarea" placeholder="اكتب ملاحظاتك هنا..." maxlength="1000"></textarea><div class="blog-actions"><span id="char-counter">0 / 1000</span><button id="save-blog-btn" data-key="blog_save_btn">حفظ</button></div></div></div>
    
    <div id="timer-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn">×</button>
            <div id="timer-container">
                <h3 data-key="timer_title_pomodoro">تايمر التركيز</h3>
                <div id="pomodoro-info">
                    <p id="pomodoro-mode" data-key="pomodoro_mode_work">جلسة تركيز</p>
                    <p id="pomodoro-cycles" data-key="pomodoro_cycles">الجولة: 1 / 4</p>
                </div>
                <div id="timer-display">25:00</div>
                <p id="pomodoro-desc" data-key="pomodoro_desc"></p>
                <div id="timer-controls">
                    <button id="start-pause-timer-btn" data-key="timer_start_btn">بدء</button>
                    <button id="reset-timer-btn" data-key="timer_reset_btn">إعادة ضبط</button>
                </div>
            </div>
        </div>
    </div>
    <div id="courses-locked-modal" class="modal-overlay full-screen"><div class="modal-content"><button class="close-btn">×</button><p id="courses-locked-message" data-key="courses_locked_msg"></p><p class="dev-credit-modal" data-key="dev_credit_text">تطوير: Amr Lotfy</p></div></div>
    <div id="lecture-content-modal" class="modal-overlay full-screen"><div class="modal-content"><button class="close-btn">×</button><div id="lecture-content"></div></div></div>
    <div id="video-player-modal" class="modal-overlay"><div class="modal-content"><button class="close-btn">×</button><div id="video-player-container"></div></div></div>
    
    <div id="meetings-locked-modal" class="modal-overlay full-screen">
        <div class="modal-content">
            <button class="close-btn">×</button>
            <p class="meetings-locked-main-text" data-key="meetings_locked_main"></p>
            <p class="meetings-locked-sub-text" data-key="meetings_locked_sub"></p>
            <p class="dev-credit-modal" data-key="dev_credit_text"></p>
        </div>
    </div>
    
    <div id="opinions-modal" class="modal-overlay full-screen">
        <div class="modal-content">
            <button class="close-btn">×</button>
            <h3 data-key="opinions_title">آراء الطلاب</h3>
            <div id="opinions-list">
                </div>
            <div id="opinion-form-container">
                <form id="opinion-form">
                    <textarea id="opinion-textarea" placeholder="اكتب رأيك هنا..." maxlength="300" required></textarea>
                    <button type="submit" id="submit-opinion-btn" data-key="opinion_submit_btn">نشر الرأي</button>
                </form>
            </div>
        </div>
    </div>

    <div id="content-editor-modal" class="modal-overlay">
        <div class="modal-content">
            <button class="close-btn">×</button>
            <h3 id="content-editor-title">إدارة محتوى: </h3>
            <div id="content-editor-content"></div>
        </div>
    </div>

    <div id="announcement-toast" class="modal-overlay">
        <div class="modal-content" style="max-width: 450px; text-align: center;">
            <button class="close-btn">&times;</button>
            <h3><i class="fas fa-bullhorn" style="color: var(--accent-color); margin-left: 10px;"></i>إعلان هام</h3>
            <p id="announcement-text" style="margin-top: 20px; line-height: 1.8;"></p>
        </div>
    </div>

    <div id="points-info-toast">
        <button class="close-toast-btn">&times;</button>
        <div id="points-info-toast-content"></div>
    </div>
    <div id="pointing-arrow"></div>

    <script>
document.addEventListener('DOMContentLoaded', () => {
    // Initial static data (will be moved to localStorage if not present)
    const initialCoursesData = { '1': { 'أعمال دولية': { '1': ['مبادئ المحاسبة المالية', 'مبادئ الاقتصاد', 'مبادئ القانون', 'لغة أجنبية (1)', 'مبادئ إدارة الأعمال', 'أساسيات الحاسب'], '2': ['محاسبة شركات', 'اقتصاديات التجارة الدولية', 'قانون دولي', 'لغة أجنبية (2)', 'إدارة الموارد البشرية', 'مبادئ التسويق'] }, 'نظم معلومات': { '1': ['طرق ومهارات الاتصال', 'رياضيات الأعمال', 'حقوق الإنسان', 'التفكير الابتكاري', 'السلوك التنظيمي', 'أساسيات الحاسب'], '2': ['مقدمة في نظم المعلومات', 'أساسيات البرمجة', 'رياضيات متقدمة', 'إدارة قواعد البيانات', 'مبادئ الإحصاء', 'لغة إنجليزية فنية'] } }, '2': { 'أعمال دولية': { '1': ['إدارة اللوجستيات وسلاسل الإمداد', 'مبادئ التسويق', 'اقتصاد جزئي', 'محاسبة التكاليف', 'قانون الأعمال'], '2': ['إدارة مالية', 'التسويق الدولي', 'اقتصاد كلي', 'محاسبة إدارية', 'نظم معلومات إدارية'] }, 'نظم معلومات': { '1': ['قانون الأعمال', 'قواعد البيانات (1)', 'إدارة الإنتاج', 'محاسبة شركات', 'تصميم برامج الحاسب'], '2': ['شبكات الحاسب (1)', 'تحليل وتصميم النظم', 'هياكل البيانات', 'بحوث العمليات', 'تطبيقات الإنترنت'] } }, '3': { 'محاسبة مالية': { '1': ['محاسبة ضريبية', 'محاسبة تكاليف متقدمة', 'تطبيقات الحاسب التجارية', 'اقتصاديات المالية العامة', 'الإحصاء التطبيقي', 'حقوق الإنسان'], '2': ['المراجعة الداخلية', 'محاسبة حكومية وقومية', 'نظم تكاليف فعلية', 'مشكلات محاسبية معاصرة', 'دراسات الجدوى'] }, 'علوم مالية ومصرفية': { '1': ['اقتصاديات المصارف', 'قانون المصارف والائتمان', 'تطبيقات الحاسب في المنشآت المالية', 'إدارة المنشآت المالية', 'حقوق الإنسان', 'الإحصاء التطبيقي'], '2': ['الأسواق المالية', 'إدارة المخاطر المالية', 'التحليل المالي', 'عمليات البنوك', 'التأمين وإدارة الخطر'] }, 'نظم معلومات': { '1': ['حقوق الإنسان', 'قواعد البيانات (2)', 'حزم الإحصاء والعمليات', 'محاسبة الضرائب', 'أمن المعلومات'], '2': ['تطوير تطبيقات الويب', 'الذكاء الاصطناعي', 'شبكات الحاسب (2)', 'إدارة المشروعات البرمجية', 'التجارة الإلكترونية'] } }, '4': { 'محاسبة مالية': { '1': ['المحاسبة الإدارية والموازنات', 'المحاسبة الدولية', 'المحاسبة في المنشآت المالية', 'نظم التكاليف', 'مشكلات محاسبية معاصرة', 'بحوث العمليات'], '2': ['مراجعة متقدمة', 'محاسبة البترول والفنادق', 'نظم المعلومات المحاسبية', 'التحليل المالي المتقدم', 'مشروع التخرج'] }, 'علوم مالية ومصرفية': { '1': ['مشكلات مصرفية ومالية معاصرة', 'الهندسة المالية', 'العقود الآجلة والمشتقات المالية', 'التمويل الدولي', 'إدارة المحافظ الاستثمارية'], '2': ['حوكمة الشركات', 'تقييم الأصول', 'استراتيجيات الاستثمار', 'الصيرفة الإسلامية', 'مشروع التخرج'] }, 'نظم معلومات': { '1': ['تأمين الشبكات', 'تنقيب البيانات', 'نظم دعم القرار', 'هندسة البرمجيات', 'إدارة مراكز المعلومات'], '2': ['الحوسبة السحابية', 'تطبيقات الموبايل', 'النظم الخبيرة', 'الجرائم الإلكترونية والتحقيق الرقمي', 'مشروع التخرج'] } } };
    
    const videoCoursesData = { 'ecommerce': { title_ar: 'كورسات التجارة الإلكترونية', title_en: 'E-commerce Courses', icon: 'fas fa-cash-register', videos: [ { title: 'كورس التجارة الالكترونية الكامل', embed_url: 'https://www.youtube.com/embed/h0unhODkj40' }, { title: 'دليلك الشامل لتبدأ في التجارة الالكترونية', embed_url: 'https://www.youtube.com/embed/ICFXS5WIS3Y' }, { title: 'أسرار التجارة الإلكترونية', embed_url: 'https://www.youtube.com/embed/q2f_BVSVeHQ' }, { title: 'كورس شامل للتجارة الإلكترونية', embed_url: 'https://www.youtube.com/embed/v46BIS_ICiA' } ] }, 'graphic-design': { title_ar: 'كورسات الجرافيك ديزاين', title_en: 'Graphic Design Courses', icon: 'fas fa-palette', videos: [ { title: 'كورس جرافيك ديزاين كامل', embed_url: 'https://www.youtube.com/embed/va-MZOPrJ0s' }, { title: 'تعلم الفوتوشوب في فيديو واحد', embed_url: 'https://www.youtube.com/embed/4IJPI0d7STI' }, { title: 'تعلم اليستريتور في فيديو واحد', embed_url: 'https://www.youtube.com/embed/WlTsKiVwZAM' } ] }, 'video-editing': { title_ar: 'كورسات المونتاج', title_en: 'Video Editing Courses', icon: 'fas fa-film', videos: [ { title: 'كورس مونتاج كامل ببرنامج واحد', embed_url: 'https://www.youtube.com/embed/qKtUjfolUOM' }, { title: 'تعلم المونتاج باستخدام أدوبي بريمير', embed_url: 'https://www.youtube.com/embed/8iGvUZKeLeU' } ] }, 'data-analysis': { title_ar: 'كورسات تحليل البيانات', title_en: 'Data Analysis Courses', icon: 'fas fa-chart-pie', videos: [ { title: 'كورس تحليل البيانات الكامل', embed_url: 'https://www.youtube.com/embed/nXdkuxAj7tg' }, { title: 'تحليل البيانات باستخدام اكسل', embed_url: 'https://www.youtube.com/embed/z7nN0hZ_PtQ' } ] }, 'ai': { title_ar: 'كورسات الذكاء الاصطناعي', title_en: 'Artificial Intelligence Courses', icon: 'fas fa-brain', videos: [ { title: 'كورس الذكاء الاصطناعي', embed_url: 'https://www.youtube.com/embed/oDmyhjwAYXk' }, { title: 'تعلم الذكاء الاصطناعي في 6 ساعات', embed_url: 'https://www.youtube.com/embed/Rp5VnXnWMLk' } ] } };
    
    const initialAiTools = [ {id: 1, name: "ChatGPT", url: "https://chatgpt.com/"}, {id: 2, name: "Gemini", url: "https://gemini.google.com/"}, {id: 3, name: "Perplexity (بحث)", url: "https://www.perplexity.ai/"}, {id: 4, name: "Claude", url: "https://claude.ai/"}, {id: 5, name: "Grammarly (كتابة)", url: "https://www.grammarly.com/"}, {id: 6, name: "QuillBot (إعادة صياغة)", url: "https://quillbot.com/"}, {id: 7, name: "WolframAlpha (حسابات)", url: "https://www.wolframalpha.com/"}, {id: 8, name: "ChatPDF", url: "https://www.chatpdf.com/"}, {id: 9, name: "Socratic (حلول)", url: "https://socratic.org/"}, {id: 10, name: "Consensus (أبحاث)", url: "https://consensus.app/"}, {id: 11, name: "Elicit (أبحاث)", url: "https://elicit.org/"}, {id: 12, name: "TutorAI (مُعلم ذكي)", url: "https://www.tutorai.me/"}, {id: 13, name: "MyBib (توثيق)", url: "https://www.mybib.com/"}, {id: 14, name: "Notion AI (تنظيم)", url: "https://www.notion.so/product/ai"}, {id: 15, name: "Meta AI", url: "https://www.meta.ai/"}, {id: 16, name: "SciSpace (أوراق علمية)", url: "https://typeset.io/"} ];

    const translations = { 
        ar: { login_choice_btn: "تسجيل الدخول", create_account_btn: "إنشاء حساب", create_account_title: "إنشاء حساب جديد", register_btn: "سجل الآن", login_title_main: "تسجيل الدخول", login_btn_main: "دخول", name_placeholder: "الاسم", password_label: "كلمة السر", password_format_hint: "يجب أن لا تقل عن 8 حروف وتحتوي على أحرف وأرقام.", password_forgot_hint: "يجب عليك عدم نسيان كلمه السر", year_placeholder: "الفرقة", year_1: "الأولى", year_2: "الثانية", year_3: "الثالثة", year_4: "الرابعة", major_placeholder: "اختر الفرقة أولاً...", major_label: "الشعبة", major_option_1: "أعمال دولية", major_option_2: "نظم معلومات", major_option_3: "محاسبة مالية", major_option_4: "علوم مالية ومصرفية", semester_label: "الفصل الدراسي", semester_1: "الفصل الدراسي الأول", semester_2: "الفصل الدراسي الثاني", semester_warning_text: "سيتم فتح هذا الفصل في الميعاد المحدد له", welcome_back: "مرحباً يـ ", nav_pdf: "كتب", nav_sections: "السكاشن", nav_ai: "AI", nav_platform: "المنصة", nav_settings: "الإعدادات", nav_about: "عنا", nav_courses: "كورسات", nav_meetings: "ميتنج", meetings_locked_main: "قسم الميتنج مغلق حالياً من قبل الإدارة.", meetings_locked_sub: "سيتم تفعيله عند وجود جلسات مباشرة.", close_btn: "إغلاق", settings_title: "الإعدادات", settings_lang: "اللغة", settings_theme: "الثيم اللوني", settings_mode: "الوضع", mode_dark: "داكن", mode_light: "فاتح", mode_oled: "ليلي", mode_gold_black: "ذهبي", about_title: "Mora for Studying", about_desc: "خاص بالمعهد العالي للحاسبات والمعلومات بطنطا", app_version: "الاصدار 11.0", about_dev: "تم التطوير بواسطه Amr lotfy.", sponsors_title: "تحت رعاية", ai_title: "اختر مساعدك الذكي", platform_title: "روابط المنصة التعليمية", redirect_dev: "تطوير: Amr Lotfy", redirect_msg: "...جاري تحويلك الآن", fill_all_fields: "الرجاء ملء جميع الحقول", password_error_length: "كلمة السر يجب أن تكون 8 أحرف على الأقل", password_error_format: "كلمة السر يجب أن تحتوي على أحرف وأرقام", lecture: "المحاضرة", section: "سيكشن", pdf: "ملف", privacy_policy_btn: "سياسة الخصوصية", privacy_title: "سياسة الخصوصية", privacy_content: "نحن في Mora for Studying نأخذ خصوصيتك على محمل الجد. البيانات التي يتم جمعها عند التسجيل (مثل الاسم، الفرقة، الشعبة) تُستخدم فقط لتخصيص تجربتك التعليمية وعرض المواد الدراسية المناسبة لك. نحن لا نشارك هذه المعلومات مع أي طرف ثالث. يتم تخزين جميع بيانات حسابك بشكل آمن على جهازك المحلي.", loading_text: "متنساش تصلي علي النبي", rate_website_btn: "قيم الموقع", rating_title: "قيم تجربتك", rating_thanks: "شكراً لتقييمك!", blog_btn: "مدونتي", blog_title: "مدونتي الشخصية", blog_save_btn: "حفظ", blog_saved_success: "تم الحفظ!", timer_btn: "تايمر", timer_title_pomodoro: "تايمر التركيز", timer_start_btn: "بدء", timer_pause_btn: "إيقاف مؤقت", timer_reset_btn: "إعادة ضبط", courses_title: "كورسات مقترحة", courses_locked_msg: "هذا القسم يتطلب <span class='highlight'>__UNLOCK__</span> نقطة للفتح. استمر في حضور المحاضرات لجمع النقاط!", dev_credit_text: "تطوير: Amr Lotfy", logout_btn: "تسجيل الخروج", logout_msg: "جاري تسجيل خروجك...", locked_lectures_msg: "لم يقم الأدمن بإضافة محتوى لهذه المحاضرة بعد.", locked_pdfs_msg: "لم يقم الأدمن بإضافة هذا الكتاب بعد.", locked_sections_msg: "لم يقم الأدمن بإضافة محتوى لهذا السكشن بعد.", auth_error_no_account: "لا يوجد حسابات مسجلة. يرجى إنشاء حساب أولاً.", auth_error_user_exists: "هذا الاسم مستخدم بالفعل", auth_error_wrong_pass: "كلمة المرور غير صحيحة", auth_error_banned: "تم حظر هذا الحساب.", captcha_enter_code: "أدخل الرمز", captcha_error: "الرمز غير صحيح، حاول مرة أخرى.", clear_data_btn: "محو البيانات", clear_data_confirm: "هل أنت متأكد من رغبتك في محو جميع البيانات؟ لا يمكن التراجع عن هذا الإجراء.", pomodoro_mode_work: "جلسة تركيز", pomodoro_mode_break: "وقت الاستراحة", pomodoro_cycles: "الجولة:", pomodoro_desc: "استخدم تقنية بومودورو لتنظيم وقتك وزيادة تركيزك، عبر جلسات عمل واستراحة متناوبة.", pomodoro_work_done: "أحسنت صنعًا! انتهت جلسة التركيز. شكرًا لالتزامك.", pomodoro_break_done: "انتهت استراحتك. لنعد إلى التركيز!", points_info_main: "لكل محاضرة تدخلها مكافأة <span class='highlight'>__POINTS__</span> نقطة، اجمع <span class='highlight'>__UNLOCK__</span> نقطة لفتح قسم الكورسات.", points_info_dev_credit: "تطوير: Amr Lotfy", timer_live_text: "جارٍ الآن", nav_opinions: "آراء الطلاب", opinions_title: "آراء الطلاب", opinion_placeholder: "اكتب رأيك هنا...", opinion_submit_btn: "نشر الرأي", opinion_success: "تم نشر رأيك بنجاح!", settings_saved: "تم حفظ الإعدادات بنجاح!", announcement_sent: "تم إرسال الإعلان بنجاح!", nav_announcements: "الإعلانات", nav_site_settings: "إعدادات الموقع", "nav_text_editor": "إدارة نصوص الموقع", nav_ratings_admin: "تقييمات الموقع", nav_ai_tools_admin: "إدارة أدوات AI" }, 
        en: { login_choice_btn: "Log In", create_account_btn: "Create Account", create_account_title: "Create New Account", register_btn: "Register Now", login_title_main: "Log In", login_btn_main: "Enter", name_placeholder: "Name", password_label: "Password", password_format_hint: "Must be 8+ characters and contain letters/numbers.", password_forgot_hint: "You must not forget your password", year_placeholder: "Year", year_1: "First", year_2: "Second", year_3: "Third", year_4: "Fourth", major_placeholder: "Select year first...", major_label: "Division", major_option_1: "International Business", major_option_2: "Information Systems", major_option_3: "Financial Accounting", major_option_4: "Financial & Banking Sciences", semester_label: "Semester", semester_1: "First Semester", semester_2: "Second Semester", semester_warning_text: "This semester will be opened at its scheduled time", welcome_back: "Welcome, ", nav_pdf: "Books", nav_sections: "Sections", nav_ai: "AI", nav_platform: "Platform", nav_settings: "Settings", nav_about: "About", nav_courses: "Courses", nav_meetings: "Meetings", meetings_locked_main: "Meetings section is currently disabled by the admin.", meetings_locked_sub: "It will be activated when live sessions are available.", close_btn: "Close", settings_title: "Settings", settings_lang: "Language", settings_theme: "Color Theme", settings_mode: "Mode", mode_dark: "Dark", mode_light: "Light", mode_oled: "OLED", mode_gold_black: "Gold", about_title: "Mora for Studying", about_desc: "Exclusive for the Higher Institute for Computers and Information in Tanta", app_version: "Version 11.0", about_dev: "Developed by Amr lotfy.", sponsors_title: "Under the sponsorship of", ai_title: "Choose your AI assistant", platform_title: "Educational Platform Links", redirect_dev: "Developed by: Amr Lotfy", redirect_msg: "Redirecting you now...", fill_all_fields: "Please fill all fields", password_error_length: "Password must be at least 8 characters long", password_error_format: "Password must contain letters and numbers", lecture: "Lecture", section: "Section", pdf: "PDF", privacy_policy_btn: "Privacy Policy", privacy_title: "Privacy Policy", privacy_content: "At Mora for Studying, we take your privacy seriously. The data collected upon registration (such as name, year, and division) is used solely to personalize your educational experience and display the appropriate course materials. We do not share this information with any third parties. All your account data is stored securely on your local device.", loading_text: "Remember to send blessings upon the Prophet", rate_website_btn: "Rate Website", rating_title: "Rate Your Experience", rating_thanks: "Thanks for your feedback!", blog_btn: "My Blog", blog_title: "My Personal Blog", blog_save_btn: "Save", blog_saved_success: "Saved!", timer_btn: "Timer", timer_title_pomodoro: "Focus Timer", timer_start_btn: "Start", timer_pause_btn: "Pause", timer_reset_btn: "Reset", courses_title: "Suggested Courses", courses_locked_msg: "This section requires <span class='highlight'>__UNLOCK__</span> points to unlock. Keep attending lectures to earn points!", dev_credit_text: "Developed by: Amr Lotfy", logout_btn: "Logout", logout_msg: "Logging you out...", locked_lectures_msg: "The admin has not added content for this lecture yet.", locked_pdfs_msg: "The admin has not added this book yet.", locked_sections_msg: "The admin has not added content for this section yet.", auth_error_no_account: "No accounts registered. Please create an account first.", auth_error_user_exists: "This username is already taken", auth_error_wrong_pass: "Incorrect password", auth_error_banned: "This account has been banned.", captcha_enter_code: "Enter the code", captcha_error: "Incorrect code, please try again.", clear_data_btn: "Clear Data", clear_data_confirm: "Are you sure you want to clear all data? This action cannot be undone.", pomodoro_mode_work: "Focus Session", pomodoro_mode_break: "Break Time", pomodoro_cycles: "Round:", pomodoro_desc: "Use the Pomodoro Technique to organize your time and increase focus through alternating work and break sessions.", pomodoro_work_done: "Excellent work! Focus session complete. Thank you for your commitment.", pomodoro_break_done: "Your break is over. Let's get back to it!", points_info_main: "Earn <span class='highlight'>__POINTS__</span> points for every lecture you attend. Collect <span class='highlight'>__UNLOCK__</span> points to unlock the Courses section.", points_info_dev_credit: "Developed by: Amr Lotfy", timer_live_text: "Live", nav_opinions: "Opinions", opinions_title: "Student Opinions", opinion_placeholder: "Write your opinion here...", opinion_submit_btn: "Publish Opinion", opinion_success: "Your opinion has been published!", settings_saved: "Settings saved successfully!", announcement_sent: "Announcement sent successfully!", nav_announcements: "Announcements", nav_site_settings: "Site Settings", "nav_text_editor": "Manage Site Text", nav_ratings_admin: "Website Ratings", nav_ai_tools_admin: "Manage AI Tools" } 
    };
    const themes = [ 
        { name: 'Forest', accent: '#00ff7f', glow: 'rgba(0,255,127,0.4)', hover: '#33ff99' }, 
        { name: 'Cosmic', accent: '#be5cff', glow: 'rgba(190,92,255,0.4)', hover: '#d89aff' }, 
        { name: 'Solar', accent: '#ff8c00', glow: 'rgba(255,140,0,0.4)', hover: '#ffa500' }, 
        { name: 'Ocean', accent: '#00bfff', glow: 'rgba(0,191,255,0.4)', hover: '#1e90ff' }, 
        { name: 'Crimson', accent: '#dc143c', glow: 'rgba(220,20,60,0.4)', hover: '#ff4500' }, 
        { name: 'Cyber', accent: '#00FFFF', glow: 'rgba(0,255,255,0.4)', hover: '#7DFDFE' }, 
        { name: 'Rose', accent: '#FF66CC', glow: 'rgba(255,102,204,0.4)', hover: '#FFB6C1' }, 
        { name: 'Gold', accent: '#FFD700', glow: 'rgba(255,215,0,0.4)', hover: '#F0E68C' }, 
        { name: 'Magenta', accent: '#ff00ff', glow: 'rgba(255,0,255,0.4)', hover: '#e600e6' },
        { name: 'Teal', accent: '#20c997', glow: 'rgba(32, 201, 151, 0.4)', hover: '#48d1b0' },
        { name: 'Indigo', accent: '#6610f2', glow: 'rgba(102, 16, 242, 0.4)', hover: '#8540f5' },
        { name: 'Orange', accent: '#fd7e14', glow: 'rgba(253, 126, 20, 0.4)', hover: '#fd9a4a' },
        { name: 'Sky', accent: '#3399ff', glow: 'rgba(51, 153, 255, 0.4)', hover: '#5ca9ff' },
        { name: 'Lime', accent: '#a7e369', glow: 'rgba(167, 227, 105, 0.4)', hover: '#b8e986' },
        { name: 'Electric Violet', accent: '#8f00ff', glow: 'rgba(143, 0, 255, 0.4)', hover: '#a333ff' },
        { name: 'Ruby', accent: '#e0115f', glow: 'rgba(224, 17, 95, 0.4)', hover: '#e64082' }
    ];
    
    const USERS_DB_KEY = 'moraUsersDB', CURRENT_USER_KEY = 'moraCurrentUser', LAST_USER_KEY = 'moraLastUser', OPINIONS_DB_KEY = 'moraStudentOpinions', COURSES_DB_KEY = 'moraCoursesDB', CONTENT_DB_KEY = 'moraContentDB', SITE_SETTINGS_KEY = 'moraSiteSettings', ANNOUNCEMENT_KEY = 'moraAnnouncement', TEXT_CONTENT_KEY = 'moraTextContentDB', RATINGS_DB_KEY = 'moraRatingsDB', AI_TOOLS_DB_KEY = 'moraAiToolsDB';

    const htmlEl = document.documentElement, body = document.body;
    const loadingPage = document.getElementById("loading-page"), loginPage = document.getElementById("login-page"), mainPage = document.getElementById("main-page"), adminPanel = document.getElementById("admin-panel");
    const authChoiceView = document.getElementById('auth-choice-view'), createAccountView = document.getElementById('create-account-view'), loginView = document.getElementById('login-view');
    const createAccountChoiceBtn = document.getElementById('create-account-choice-btn'), loginChoiceBtn = document.getElementById('login-choice-btn');
    const createAccountForm = document.getElementById('create-account-form'), loginForm = document.getElementById('login-form');
    const authMessage = document.getElementById('auth-message');
    const yearSelect = document.getElementById("year"), majorSelect = document.getElementById("major"), semesterSelect = document.getElementById("semester"), semesterWarning = document.getElementById("semester-warning");
    
    const captchaCanvas = document.getElementById('captcha-canvas');
    const captchaRefreshBtn = document.getElementById('captcha-refresh-btn');
    const captchaInput = document.getElementById('captcha-input');
    let captchaText = '';
    
    const welcomeMessageName = document.getElementById("welcome-message-name"), welcomeMessageDetails = document.getElementById("welcome-message-details");
    const coursesContainer = document.getElementById("courses-container");
    const detailsView = document.getElementById("details-view"), detailsViewTitle = document.getElementById("details-view-title"), detailsViewList = document.getElementById("details-view-list"), backToCoursesBtn = document.getElementById("back-to-courses-btn");
    
    // START: TIMER & NEW UI ELEMENTS
    const timerContainer = document.getElementById('timer-container');
    const timerDisplay = document.getElementById('timer-display');
    const startPauseTimerBtn = document.getElementById('start-pause-timer-btn');
    const resetTimerBtn = document.getElementById('reset-timer-btn');
    const pomodoroMode = document.getElementById('pomodoro-mode');
    const pomodoroCycles = document.getElementById('pomodoro-cycles');
    const timerLiveIndicator = document.getElementById('timer-live-indicator');
    const timerLiveText = document.getElementById('timer-live-text');
    const pointsCounter = document.getElementById('points-counter');
    const pointsInfoToast = document.getElementById('points-info-toast');
    const pointsInfoToastContent = document.getElementById('points-info-toast-content');
    const closeToastBtn = pointsInfoToast.querySelector('.close-toast-btn');
    const pointingArrow = document.getElementById('pointing-arrow');
    const opinionForm = document.getElementById('opinion-form');
    const opinionTextarea = document.getElementById('opinion-textarea');
    const opinionsList = document.getElementById('opinions-list');
    const adminLogoutBtn = document.getElementById('admin-logout-btn');
    const studentCountEl = document.getElementById('student-count');
    const opinionsCountEl = document.getElementById('opinions-count');
    const subjectsCountEl = document.getElementById('subjects-count');
    const topStudentEl = document.getElementById('top-student');
    const adminStudentListContainer = document.getElementById('admin-student-list');
    const adminNavLinks = document.querySelectorAll('.admin-nav-link');
    const contentEditorModal = document.getElementById('content-editor-modal');
    const lectureContentModal = document.getElementById('lecture-content-modal');
    const announcementToast = document.getElementById('announcement-toast');
    const activeStudentsListEl = document.getElementById('active-students-list');

    let timerInterval;
    let isTimerRunning = false;
    let pomodoroState = 'work';
    let workDuration = 25 * 60;
    let breakDuration = 5 * 60;
    let timeRemaining = workDuration;
    let cycleCount = 1;
    let pointsToastTimeout;
    let activeUserInterval;
    // END: TIMER & NEW UI ELEMENTS
    
    const pointsDisplay = document.getElementById('points-display'), coursesBtn = document.getElementById('courses-btn'), coursesIcon = document.getElementById('courses-icon'), coursesLockedModal = document.getElementById('courses-locked-modal'), lockedMessageP = document.getElementById('courses-locked-message');
    const redirectModal = document.getElementById('redirect-modal'), timerElement = document.getElementById('redirect-timer');
    const pointsNotification = document.getElementById('points-notification');
    
    const meetingsBtn = document.getElementById('meetings-btn');
    const meetingsLockedModal = document.getElementById('meetings-locked-modal');

    let countdownInterval, currentView = 'subjects'; 

    // --- START: PROFESSIONAL LOGIN PAGE ANIMATION ---
    const loginAnimationCanvas = document.getElementById('login-animation-canvas');
    const loginAnimationCtx = loginAnimationCanvas.getContext('2d');
    let particlesArray;

    function hexToRgb(hex) {
        const shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
        hex = hex.replace(shorthandRegex, (m, r, g, b) => r + r + g + g + b + b);
        const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? `${parseInt(result[1], 16)}, ${parseInt(result[2], 16)}, ${parseInt(result[3], 16)}` : null;
    }

    function setupLoginAnimation() {
        loginAnimationCanvas.width = window.innerWidth;
        loginAnimationCanvas.height = window.innerHeight;
        particlesArray = [];
        const numberOfParticles = (loginAnimationCanvas.height * loginAnimationCanvas.width) / 9000;
        const accentColor = getComputedStyle(body).getPropertyValue('--accent-color').trim();
        for (let i = 0; i < numberOfParticles; i++) {
            let size = (Math.random() * 2) + 1;
            let x = (Math.random() * ((innerWidth - size * 2) - (size * 2)) + size * 2);
            let y = (Math.random() * ((innerHeight - size * 2) - (size * 2)) + size * 2);
            let directionX = (Math.random() * .5) - .25;
            let directionY = (Math.random() * .5) - .25;
            particlesArray.push({ x, y, directionX, directionY, size, color: accentColor });
        }
    }

    function connectParticles() {
        let opacityValue = 1;
        const accentColor = getComputedStyle(body).getPropertyValue('--accent-color').trim();
        const accentRgb = hexToRgb(accentColor);
        if (!accentRgb) return;

        for (let a = 0; a < particlesArray.length; a++) {
            for (let b = a; b < particlesArray.length; b++) {
                let distance = ((particlesArray[a].x - particlesArray[b].x) * (particlesArray[a].x - particlesArray[b].x)) +
                                 ((particlesArray[a].y - particlesArray[b].y) * (particlesArray[a].y - particlesArray[b].y));
                if (distance < (loginAnimationCanvas.width / 7) * (loginAnimationCanvas.height / 7)) {
                    opacityValue = 1 - (distance / 20000);
                    loginAnimationCtx.strokeStyle = `rgba(${accentRgb}, ${opacityValue})`;
                    loginAnimationCtx.lineWidth = 0.5;
                    loginAnimationCtx.beginPath();
                    loginAnimationCtx.moveTo(particlesArray[a].x, particlesArray[a].y);
                    loginAnimationCtx.lineTo(particlesArray[b].x, particlesArray[b].y);
                    loginAnimationCtx.stroke();
                }
            }
        }
    }

    function animateLoginBackground() {
        requestAnimationFrame(animateLoginBackground);
        if (!loginPage.classList.contains('active')) {
            loginAnimationCtx.clearRect(0, 0, innerWidth, innerHeight);
            return;
        };
        
        loginAnimationCtx.clearRect(0, 0, innerWidth, innerHeight);
        const accentColor = getComputedStyle(body).getPropertyValue('--accent-color').trim();

        for (let i = 0; i < particlesArray.length; i++) {
            particlesArray[i].color = accentColor;
            loginAnimationCtx.beginPath();
            loginAnimationCtx.arc(particlesArray[i].x, particlesArray[i].y, particlesArray[i].size, 0, Math.PI * 2, false);
            loginAnimationCtx.fillStyle = particlesArray[i].color;
            loginAnimationCtx.fill();

            if (particlesArray[i].x + particlesArray[i].size > loginAnimationCanvas.width || particlesArray[i].x - particlesArray[i].size < 0) {
                particlesArray[i].directionX = -particlesArray[i].directionX;
            }
            if (particlesArray[i].y + particlesArray[i].size > loginAnimationCanvas.height || particlesArray[i].y - particlesArray[i].size < 0) {
                particlesArray[i].directionY = -particlesArray[i].directionY;
            }
            particlesArray[i].x += particlesArray[i].directionX;
            particlesArray[i].y += particlesArray[i].directionY;
        }
        connectParticles();
    }
    // --- END: PROFESSIONAL LOGIN PAGE ANIMATION ---

    // --- START: DATA HANDLING FUNCTIONS ---
    function getFromStorage(key, defaultValue) {
        try {
            const item = localStorage.getItem(key);
            return item ? JSON.parse(item) : defaultValue;
        } catch (e) {
            console.error(`Error parsing JSON from localStorage key "${key}":`, e);
            return defaultValue;
        }
    }

    function getUsersDB() { return getFromStorage(USERS_DB_KEY, {}); }
    function getOpinions() { return getFromStorage(OPINIONS_DB_KEY, []); }
    function getRatings() { return getFromStorage(RATINGS_DB_KEY, []); }
    function getCoursesDB() {
        let courses = getFromStorage(COURSES_DB_KEY, null);
        if (!courses) {
            localStorage.setItem(COURSES_DB_KEY, JSON.stringify(initialCoursesData));
            return initialCoursesData;
        }
        return courses;
    }
    function getContentDB() { return getFromStorage(CONTENT_DB_KEY, {}); }
    function getSiteSettings() {
        const defaults = { 
            siteName: "Mora for Studying",
            pointsToUnlock: 250, 
            pointsPerLecture: 9, 
            bannerText: "شكر خاص وتقدير لإدارة المعهد وأعضاء هيئة التدريس على دعمهم المتواصل وجهودهم المبذولة في سبيل عمل هذا الويب سايت التعليمي.",
            coursesUnlocked: false,
            meetingsUnlocked: false,
            meetingUrl: ''
        };
        return getFromStorage(SITE_SETTINGS_KEY, defaults);
    }
    function getAiToolsDB() {
        let tools = getFromStorage(AI_TOOLS_DB_KEY, null);
        if (!tools) {
            localStorage.setItem(AI_TOOLS_DB_KEY, JSON.stringify(initialAiTools));
            return initialAiTools;
        }
        return tools;
    }
    function getAnnouncement() { return getFromStorage(ANNOUNCEMENT_KEY, null); }
    function getTextContentDB() { 
        let texts = getFromStorage(TEXT_CONTENT_KEY, null);
        if (!texts) {
            localStorage.setItem(TEXT_CONTENT_KEY, JSON.stringify(translations.ar));
            return translations.ar;
        }
        return texts;
    }

    function saveUsersDB(db) { localStorage.setItem(USERS_DB_KEY, JSON.stringify(db)); }
    function saveOpinions(opinionsArray) { localStorage.setItem(OPINIONS_DB_KEY, JSON.stringify(opinionsArray)); }
    function saveRatings(ratingsArray) { localStorage.setItem(RATINGS_DB_KEY, JSON.stringify(ratingsArray)); }
    function saveCoursesDB(data) { localStorage.setItem(COURSES_DB_KEY, JSON.stringify(data)); }
    function saveContentDB(data) { localStorage.setItem(CONTENT_DB_KEY, JSON.stringify(data)); }
    function saveSiteSettings(settings) { localStorage.setItem(SITE_SETTINGS_KEY, JSON.stringify(settings)); }
    function saveAiToolsDB(tools) { localStorage.setItem(AI_TOOLS_DB_KEY, JSON.stringify(tools)); }
    function saveAnnouncement(announcement) { localStorage.setItem(ANNOUNCEMENT_KEY, JSON.stringify(announcement)); }
    function saveTextContentDB(texts) { localStorage.setItem(TEXT_CONTENT_KEY, JSON.stringify(texts)); }

    function getUserData(username, key) { const db = getUsersDB(); return db[username]?.data?.[key]; }
    function getUserProfile(username) { const db = getUsersDB(); return db[username]?.profile; }
    function setUserData(username, key, value) { const db = getUsersDB(); if (db[username]) { if (!db[username].data) { db[username].data = {}; } db[username].data[key] = value; saveUsersDB(db); } }
    function getCurrentUsername() { return localStorage.getItem(CURRENT_USER_KEY); }
    function getCurrentUserRole() { return localStorage.getItem('moraCurrentUserRole'); }
    // --- END: DATA HANDLING FUNCTIONS ---

    function getPoints() { const username = getCurrentUsername(); if (!username || username === 'admen') return 0; return getUserData(username, 'points') || 0; }
    
    function addPoints(amount, contentId) {
        const username = getCurrentUsername();
        if (!username || username === 'admen') return;

        let viewedContent = getUserData(username, 'viewedContent') || [];
        if (viewedContent.includes(contentId)) {
            return; // Already earned points for this item
        }
        
        viewedContent.push(contentId);
        setUserData(username, 'viewedContent', viewedContent);

        let currentPoints = getPoints();
        currentPoints += amount;
        setUserData(username, 'points', currentPoints);
        
        pointsDisplay.textContent = currentPoints;
        pointsNotification.classList.remove('show');
        void pointsNotification.offsetWidth;
        pointsNotification.classList.add('show');
        updateCoursesButtonState();
    }
    
    function updateCoursesButtonState() {
        const settings = getSiteSettings();
        const points = getPoints();
        if (settings.coursesUnlocked || points >= settings.pointsToUnlock) {
            coursesBtn.classList.remove('locked');
            coursesIcon.className = 'fas fa-crown'; 
        } else {
            coursesBtn.classList.add('locked');
            coursesIcon.className = 'fas fa-lock';
        }
    }

    function updateUserActivity() {
        const username = getCurrentUsername();
        if (username && username !== 'admen') {
            setUserData(username, 'last_active', Date.now());
        }
    }
    
    function setLanguage(lang) {
        htmlEl.lang = lang;
        htmlEl.dir = lang === 'ar' ? 'rtl' : 'ltr';
        const siteTexts = getTextContentDB();
        const langTexts = lang === 'ar' ? siteTexts : translations.en;

        document.querySelectorAll('[data-key]').forEach(el => {
            const key = el.dataset.key;
            if (langTexts[key]) {
                const settings = getSiteSettings();
                let text = langTexts[key];
                text = text.replace('__UNLOCK__', settings.pointsToUnlock).replace('__POINTS__', settings.pointsPerLecture);
                
                if (key.includes('courses_locked_msg') || key.includes('points_info_main')) {
                    el.innerHTML = text;
                } else {
                    el.textContent = text;
                }
            }
        });
        localStorage.setItem('moraLectureHubLang', lang);
        updateMajors(yearSelect.value, majorSelect);
        updateActiveUI();
    }
    
    function setSetting(type, value) { 
        if (type === 'theme') { 
            localStorage.setItem('moraLectureHubTheme', value.name); 
            body.style.setProperty('--accent-color', value.accent); 
            body.style.setProperty('--accent-glow', value.glow); 
            body.style.setProperty('--accent-hover', value.hover); 
            if(loginPage.classList.contains('active')) setupLoginAnimation();
        } else if (type === 'mode') { 
            body.className = value; 
            localStorage.setItem('moraLectureHubMode', value); 
        } 
        updateActiveUI(); 
    }

    function populateThemeButtons() { 
        const themeContainer = document.getElementById('theme-switcher'); 
        themeContainer.innerHTML = ''; 
        themes.forEach(theme => { 
            const btn = document.createElement('button'); 
            btn.className = 'theme-btn'; 
            btn.title = theme.name; 
            btn.innerHTML = `<span class="theme-swatch" style="background-color:${theme.accent};"></span> <span>${theme.name}</span>`; 
            btn.addEventListener('click', () => setSetting('theme', theme)); 
            themeContainer.appendChild(btn); 
        }); 
    }

    function updateActiveUI() { const lang = localStorage.getItem('moraLectureHubLang') || 'ar'; document.querySelectorAll('#lang-switcher .settings-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.lang === lang)); const themeName = localStorage.getItem('moraLectureHubTheme') || 'Forest'; const theme = themes.find(t => t.name === themeName) || themes[0]; document.querySelectorAll('#theme-switcher .theme-btn').forEach(btn => btn.classList.toggle('active', btn.title === themeName)); const mode = localStorage.getItem('moraLectureHubMode') || 'mode-dark'; document.querySelectorAll('#mode-switcher .settings-btn').forEach(btn => btn.classList.toggle('active', btn.dataset.mode === mode)); }
    function showAuthMessage(messageKey) { const lang = htmlEl.lang || 'ar'; const siteTexts = getTextContentDB(); authMessage.textContent = siteTexts[messageKey] || translations.en[messageKey] || "Action completed."; authMessage.style.display = 'block'; setTimeout(() => { authMessage.style.display = 'none'; }, 2500); }
    
    function updateMajors(year, majorDropdown) {
        const lang = htmlEl.lang || 'ar';
        const siteTexts = getTextContentDB();
        majorDropdown.innerHTML = `<option value="" disabled selected>${siteTexts.major_placeholder}</option>`;
        let majors = {};
        if (year === '1' || year === '2') {
            majors = { "أعمال دولية": "major_option_1", "نظم معلومات": "major_option_2" };
        } else if (year === '3' || year === '4') {
            majors = { "محاسبة مالية": "major_option_3", "علوم مالية ومصرفية": "major_option_4", "نظم معلومات": "major_option_2" };
        }
        for (const majorName in majors) {
            const key = majors[majorName];
            majorDropdown.innerHTML += `<option value="${majorName}" data-key="${key}">${siteTexts[key]}</option>`;
        }
    }
    
    function generateNumericCaptcha() {
        const ctx = captchaCanvas.getContext('2d');
        captchaText = Math.random().toString().substring(2, 8);
        const text_color = getComputedStyle(body).getPropertyValue('--primary-text-color');
        ctx.clearRect(0, 0, captchaCanvas.width, captchaCanvas.height);
        ctx.fillStyle = getComputedStyle(body).getPropertyValue('--secondary-bg');
        ctx.fillRect(0, 0, captchaCanvas.width, captchaCanvas.height);
        ctx.font = 'bold 24px "Orbitron", sans-serif';
        ctx.fillStyle = text_color;
        ctx.textAlign = 'center';
        ctx.textBaseline = 'middle';
        for (let i = 0; i < captchaText.length; i++) {
            const x = 18 + i * 16;
            const y = captchaCanvas.height / 2 + (Math.random() - 0.5) * 8;
            const angle = (Math.random() - 0.5) * 0.4;
            ctx.save();
            ctx.translate(x, y);
            ctx.rotate(angle);
            ctx.fillText(captchaText[i], 0, 0);
            ctx.restore();
        }
        for (let i = 0; i < 5; i++) {
            ctx.beginPath();
            ctx.moveTo(Math.random() * captchaCanvas.width, Math.random() * captchaCanvas.height);
            ctx.lineTo(Math.random() * captchaCanvas.width, Math.random() * captchaCanvas.height);
            ctx.strokeStyle = text_color;
            ctx.globalAlpha = 0.3;
            ctx.stroke();
            ctx.globalAlpha = 1.0;
        }
    }

    function updateSiteNameUI() {
        const settings = getSiteSettings();
        const siteName = settings.siteName || "Mora for Studying";
        document.title = siteName;
        document.querySelector('.login-header .welcome-text').textContent = `Welcome to ${siteName}`;
        document.getElementById('admin-site-name-header').textContent = `${siteName} Admin`;
        const aboutTitle = document.querySelector('#about-modal h3');
        if (aboutTitle) aboutTitle.textContent = siteName;
    }

    function initializeApp() {
        getTextContentDB(); // Initialize texts
        getAiToolsDB(); // Initialize AI Tools
        const lang = localStorage.getItem('moraLectureHubLang') || 'ar'; 
        const themeName = localStorage.getItem('moraLectureHubTheme') || 'Forest'; 
        const theme = themes.find(t => t.name === themeName) || themes[0];
        const mode = localStorage.getItem('moraLectureHubMode') || 'mode-dark';
        setLanguage(lang);
        setSetting('theme', theme);
        setSetting('mode', mode);
        getCoursesDB(); // Initialize courses in localStorage
        const settings = getSiteSettings(); // Load settings
        updateSiteNameUI();
        document.querySelector('.scrolling-banner p').textContent = settings.bannerText;

        loadingPage.classList.add('active');
        
        setTimeout(() => {
            const loggedInUser = getCurrentUsername();
            const userRole = getCurrentUserRole();
            loadingPage.classList.remove('active');
            if (loggedInUser) {
                if (userRole === 'admin') {
                    showAdminPanel();
                } else {
                    const userData = getUserProfile(loggedInUser);
                    if (userData) {
                        populateMainPage(userData);
                        mainPage.classList.add('active');
                        checkAnnouncement();
                    } else { // Data inconsistency
                        localStorage.clear();
                        location.reload();
                    }
                }
            } else {
                loginPage.classList.add('active');
                showAuthView('choice');
            }
        }, 2500);
    }
    
    function showAuthView(viewName, extras = {}) {
        [authChoiceView, createAccountView, loginView].forEach(v => v.classList.remove('active'));
        if (viewName === 'choice') {
            authChoiceView.classList.add('active');
        } else if (viewName === 'create') {
            createAccountView.classList.add('active');
            generateNumericCaptcha();
            captchaInput.value = '';
             fetch('https://ipapi.co/json/')
                .then(res => res.json())
                .then(data => {
                    document.getElementById('create-country').value = data.country_name || 'N/A';
                    document.getElementById('create-governorate').value = data.region || 'N/A';
                })
                .catch(() => {
                    document.getElementById('create-country').value = 'Unknown';
                    document.getElementById('create-governorate').value = 'Unknown';
                });
        } else if (viewName === 'login') {
            const loginNameInput = document.getElementById('login-name');
            const loginPasswordInput = document.getElementById('login-password');
            const lastUser = localStorage.getItem(LAST_USER_KEY);
            const users = getUsersDB();
            
            loginNameInput.value = lastUser || Object.keys(users).find(u => u !== 'admen') || '';
            loginPasswordInput.value = '';

            if (extras.newPassword) {
                 loginPasswordInput.value = extras.newPassword;
                 loginNameInput.value = extras.newName;
            }

            [loginNameInput, loginPasswordInput].forEach(input => {
                const label = input.parentElement.querySelector('label') || input.parentElement.parentElement.querySelector('label');
                if (input.value && label) {
                    label.classList.add('active-programmatically'); 
                } else if(label) {
                    label.classList.remove('active-programmatically');
                }
            });

            loginView.classList.add('active');
        }
    }


    function populateMainPage(userData) {
        updateUserActivity();
        const lang = htmlEl.lang || 'ar';
        const coursesData = getCoursesDB();
        const siteTexts = getTextContentDB();
        const semesterText = siteTexts[`semester_${userData.semester}`] || userData.semester; 
        const yearText = siteTexts[`year_${userData.year}`] || userData.year; 
        const majorText = userData.major; 
        welcomeMessageName.textContent = `${siteTexts.welcome_back}${userData.name}`; 
        welcomeMessageDetails.textContent = `${majorText} - ${yearText} - ${semesterText}`; 
        pointsDisplay.textContent = getPoints(); 
        updateCoursesButtonState(); 
        checkRatedStatus(); 
        coursesContainer.innerHTML = ""; 
        const subjects = coursesData[userData.year]?.[majorText]?.[userData.semester] || [];
        if (subjects.length > 0) { 
            subjects.forEach((subject, index) => { 
                const card = document.createElement('div'); 
                card.className = 'course-card'; 
                card.innerHTML = `<i class="fas ${getIconForCourse(subject)}"></i><h3>${subject}</h3>`; 
                card.style.animationDelay = `${0.1 * index}s`; 
                card.addEventListener('click', () => showSubjectContent(subject, 'all')); 
                coursesContainer.appendChild(card); 
            }); 
        } 
        currentView = 'subjects'; 
    }
    
    function getIconForCourse(e) { const t = e.toLowerCase(); return t.includes("محاسبة") || t.includes("مالية") || t.includes("تكاليف") || t.includes("ضريبية") ? "fa-calculator" : t.includes("اقتصاد") ? "fa-chart-line" : t.includes("قانون") ? "fa-gavel" : t.includes("إدارة") || t.includes("اعمال") || t.includes("سلوك") || t.includes("تسويق") ? "fa-briefcase" : t.includes("حاسب") || t.includes("معلومات") || t.includes("بيانات") || t.includes("برامج") || t.includes("شبكات") ? "fa-laptop-code" : t.includes("رياضيات") || t.includes("احصاء") || t.includes("كمية") ? "fa-square-root-alt" : t.includes("لغة") || t.includes("اتصال") ? "fa-language" : t.includes("حقوق") ? "fa-landmark" : t.includes("مصرفية") || t.includes("بنوك") ? "fa-university" : "fa-book-open"; }
    function getCurrentUserData() { const username = getCurrentUsername(); if(!username) return null; return getUserProfile(username); }
    
    function showSubjectContent(subjectTitle, contentType) {
        updateUserActivity();
        const lang = htmlEl.lang || 'ar';
        const contentDB = getContentDB();
        const siteTexts = getTextContentDB();
        const subjectContent = contentDB[subjectTitle] || { lectures: [], pdfs: [], sections: [] };
        const contentModalEl = document.getElementById('lecture-content');
        const settings = getSiteSettings();

        const createContentItem = (item, typeKey) => {
            const itemEl = document.createElement('div');
            itemEl.className = 'detail-item unlocked'; 
            let iconClass = 'fa-file-alt';
            if (typeKey === 'pdfs') iconClass = 'fa-file-pdf';
            if (typeKey === 'sections') iconClass = 'fa-layer-group';
            if (item.type === 'video') iconClass = 'fa-play-circle';

            itemEl.innerHTML = `<span>${item.title}</span><i class="fas ${iconClass} lock-icon"></i>`;
            itemEl.addEventListener('click', () => {
                const contentId = `${subjectTitle}-${item.id}`;
                if (typeKey === 'lectures') addPoints(settings.pointsPerLecture, contentId); 
                
                if (item.type === 'video' || item.type === 'pdf') {
                    showRedirectModal(null, () => window.open(item.url, '_blank'));
                } else {
                    contentModalEl.innerHTML = `<h3>${item.title}</h3><p>${item.content.replace(/\n/g, '<br>')}</p>`;
                    lectureContentModal.classList.add('active');
                }
            });
            return itemEl;
        };
        
        const renderList = (type, listTitle) => {
            detailsViewList.innerHTML = '';
            const contentArray = subjectContent[type] || [];
            const publishedContent = contentArray.filter(item => item.isPublished);

            if (publishedContent.length > 0) {
                 publishedContent.forEach(item => {
                     detailsViewList.appendChild(createContentItem(item, type));
                 });
            } else {
                 detailsViewList.innerHTML = `<p style="text-align:center; opacity:0.7; margin-top: 20px;">${siteTexts[`locked_${type}_msg`]}</p>`;
            }
        };

        if (contentType === 'all') {
            detailsViewTitle.textContent = subjectTitle;
            detailsViewList.innerHTML = ''; 
            
            const renderSection = (type, title) => {
                const publishedContent = (subjectContent[type] || []).filter(item => item.isPublished);
                if (publishedContent.length > 0) {
                    detailsViewList.innerHTML += `<h4 style="margin-top: 20px; padding: 0 15px;">${title}</h4>`;
                    publishedContent.forEach(item => detailsViewList.appendChild(createContentItem(item, type)));
                }
            };
            
            renderSection('lectures', 'المحاضرات');
            renderSection('pdfs', 'الكتب والمراجع');
            renderSection('sections', 'السكاشن');

            if (detailsViewList.innerHTML.trim() === '') {
                 detailsViewList.innerHTML = `<p style="text-align:center; opacity:0.7; margin-top: 20px;">لا يوجد محتوى منشور لهذه المادة حالياً.</p>`;
            }

        } else {
            const typeKey = contentType.replace('nav_', '');
            detailsViewTitle.textContent = `${subjectTitle} - ${siteTexts[`nav_${typeKey}`]}`;
            renderList(typeKey);
        }
        
        mainPage.classList.add('details-active');
    }
    
    function showContentListForType(contentType) {
        updateUserActivity();
        const userData = getCurrentUserData();
        if (!userData) return;
        const coursesData = getCoursesDB();
        const subjects = coursesData[userData.year]?.[userData.major]?.[userData.semester] || [];
        const siteTexts = getTextContentDB();
        
        detailsViewTitle.textContent = siteTexts[`nav_${contentType}`];
        detailsViewList.innerHTML = '';
        
        subjects.forEach((subject) => {
            const item = document.createElement('div');
            item.className = 'detail-item';
            item.innerHTML = `<span>${subject}</span><i class="fas fa-chevron-left lock-icon"></i>`;
            item.addEventListener('click', () => showSubjectContent(subject, contentType));
            detailsViewList.appendChild(item);
        });
        
        mainPage.classList.add('details-active');
    }

    function displayVideoCategories() { updateUserActivity(); const lang = htmlEl.lang || 'ar'; coursesContainer.innerHTML = ""; Object.keys(videoCoursesData).forEach((key, index) => { const category = videoCoursesData[key]; const card = document.createElement('div'); card.className = 'course-card'; card.innerHTML = `<i class="${category.icon}"></i><h3>${lang === 'ar' ? category.title_ar : category.title_en}</h3>`; card.style.animationDelay = `${0.1 * index}s`; card.addEventListener('click', () => showVideoList(key)); coursesContainer.appendChild(card); }); currentView = 'videos'; }
    function showVideoList(categoryKey) { updateUserActivity(); const lang = htmlEl.lang || 'ar'; const category = videoCoursesData[categoryKey]; if (!category) return; detailsViewTitle.textContent = lang === 'ar' ? category.title_ar : category.title_en; detailsViewList.innerHTML = ''; category.videos.forEach((video, index) => { const item = document.createElement('div'); item.className = 'detail-item'; item.style.animationDelay = `${index * 0.05}s`; item.innerHTML = `<span>${video.title}</span> <i class="fas fa-play-circle lock-icon"></i>`; item.addEventListener('click', () => showVideoPlayerModal(video.embed_url)); detailsViewList.appendChild(item); }); mainPage.classList.add('details-active'); }
    function showVideoPlayerModal(embedUrl) { updateUserActivity(); const videoPlayerModal = document.getElementById('video-player-modal'); const videoContainer = document.getElementById('video-player-container'); if (!videoPlayerModal || !videoContainer) return; videoContainer.innerHTML = `<iframe src="${embedUrl}" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>`; videoPlayerModal.classList.add('active'); }
    
    // --- POMODORO TIMER FUNCTIONS ---
    function formatTime(seconds) { const m = Math.floor(seconds / 60); const s = seconds % 60; return `${m < 10 ? '0' : ''}${m}:${s < 10 ? '0' : ''}${s}`; }
    function updateTimerDisplay() { timerDisplay.textContent = formatTime(timeRemaining); }
    function updatePomodoroUI() { const siteTexts = getTextContentDB(); if (pomodoroState === 'work') { timerContainer.classList.remove('break-mode'); timerContainer.classList.add('work-mode'); pomodoroMode.textContent = siteTexts.pomodoro_mode_work; } else { timerContainer.classList.remove('work-mode'); timerContainer.classList.add('break-mode'); pomodoroMode.textContent = siteTexts.pomodoro_mode_break; } pomodoroCycles.textContent = `${siteTexts.pomodoro_cycles} ${cycleCount} / 4`; }
    function startPauseTimer() { const siteTexts = getTextContentDB(); if (isTimerRunning) { clearInterval(timerInterval); startPauseTimerBtn.textContent = siteTexts.timer_start_btn; startPauseTimerBtn.classList.remove('running'); timerLiveIndicator.classList.remove('active'); timerLiveText.classList.remove('active'); } else { timerLiveIndicator.classList.add('active'); timerLiveText.classList.add('active'); timerInterval = setInterval(() => { timeRemaining--; updateTimerDisplay(); if (timeRemaining <= 0) { clearInterval(timerInterval); const completedState = pomodoroState; if (pomodoroState === 'work') { pomodoroState = 'break'; timeRemaining = breakDuration; if (cycleCount >= 4) { cycleCount = 1; } } else { pomodoroState = 'work'; timeRemaining = workDuration; cycleCount++; } updatePomodoroUI(); updateTimerDisplay(); isTimerRunning = false; startPauseTimerBtn.textContent = siteTexts.timer_start_btn; startPauseTimerBtn.classList.remove('running'); timerLiveIndicator.classList.remove('active'); timerLiveText.classList.remove('active'); if (completedState === 'work') { showAuthMessage('pomodoro_work_done'); } else { showAuthMessage('pomodoro_break_done'); } } }, 1000); startPauseTimerBtn.textContent = siteTexts.timer_pause_btn; startPauseTimerBtn.classList.add('running'); } isTimerRunning = !isTimerRunning; }
    function resetTimer() { const siteTexts = getTextContentDB(); clearInterval(timerInterval); isTimerRunning = false; pomodoroState = 'work'; cycleCount = 1; timeRemaining = workDuration; updatePomodoroUI(); updateTimerDisplay(); startPauseTimerBtn.textContent = siteTexts.timer_start_btn; startPauseTimerBtn.classList.remove('running'); timerLiveIndicator.classList.remove('active'); timerLiveText.classList.remove('active'); }
    
    // --- OPINIONS FUNCTIONS ---
    function renderOpinions() {
        const opinions = getOpinions();
        const siteTexts = getTextContentDB();
        opinionsList.innerHTML = '';
        if (opinions.length === 0) {
            opinionsList.innerHTML = `<p style="text-align:center; opacity: 0.7;">لا توجد آراء حالياً. كن أول من يشارك رأيه!</p>`;
        } else {
            opinions.forEach((opinion, index) => {
                const card = document.createElement('div');
                card.className = 'opinion-card';
                card.style.animationDelay = `${index * 0.1}s`;
                const date = new Date(opinion.timestamp).toLocaleString();
                const yearText = siteTexts[`year_${opinion.year}`] || opinion.year;
                const majorText = opinion.major;

                card.innerHTML = `<div class="opinion-card-header"><div class="opinion-author-details"><span class="opinion-author">${opinion.name}</span><span class="opinion-meta">${majorText} - ${yearText}</span></div><span class="opinion-timestamp">${date}</span></div><p class="opinion-text">${opinion.opinion}</p>`;
                opinionsList.appendChild(card);
            });
        }
    }
    
    function handleOpinionSubmit(e) {
        e.preventDefault();
        const opinionText = opinionTextarea.value.trim();
        if (!opinionText) return;

        const currentUser = getCurrentUsername();
        const userProfile = getUserProfile(currentUser);
        if (!currentUser || !userProfile) return;

        const newOpinion = {
            id: Date.now(),
            name: currentUser,
            year: userProfile.year,
            major: userProfile.major,
            opinion: opinionText,
            timestamp: new Date().toISOString()
        };

        const opinions = getOpinions();
        opinions.unshift(newOpinion);
        saveOpinions(opinions);
        
        renderOpinions();
        opinionTextarea.value = '';
        showAuthMessage('opinion_success');
    }

    // --- ADMIN PANEL FUNCTIONS ---
    function showAdminPanel() { loginPage.classList.remove('active'); mainPage.classList.remove('active'); adminPanel.classList.add('active'); populateAdminPanel(); clearInterval(activeUserInterval); activeUserInterval = setInterval(populateActiveUsers, 15000); }
    function populateAdminPanel() { populateAdminStats(); populateAdminOpinions(); populateStudentList(); populateSiteSettings(); populateAdminTextEditor(); populateActiveUsers(); populateAdminRatings(); populateAdminAiTools(); }

    function populateActiveUsers() {
        const users = getUsersDB();
        const now = Date.now();
        const fiveMinutes = 5 * 60 * 1000;
        activeStudentsListEl.innerHTML = '';
        let activeCount = 0;
        Object.keys(users).forEach(username => {
            if (username !== 'admen') {
                const lastActive = users[username].data?.last_active;
                if (lastActive && (now - lastActive < fiveMinutes)) {
                    const li = document.createElement('li');
                    li.textContent = username;
                    activeStudentsListEl.appendChild(li);
                    activeCount++;
                }
            }
        });
        if (activeCount === 0) {
            activeStudentsListEl.innerHTML = `<li>لا يوجد طلاب نشطون حاليًا.</li>`;
        }
    }

    function populateAdminStats() {
        const users = getUsersDB();
        const studentCount = Object.keys(users).filter(user => user !== 'admen').length;
        studentCountEl.textContent = studentCount;
        const opinions = getOpinions();
        opinionsCountEl.textContent = opinions.length;
        const coursesData = getCoursesDB();
        let subjectsCount = 0;
        Object.values(coursesData).forEach(year => Object.values(year).forEach(major => Object.values(major).forEach(semester => { subjectsCount += semester.length; })));
        subjectsCountEl.textContent = subjectsCount;
        let topStudent = { name: '-', points: -1 };
        Object.keys(users).forEach(username => {
            if (username !== 'admen') {
                const userPoints = users[username].data?.points || 0;
                if (userPoints > topStudent.points) {
                    topStudent = { name: username, points: userPoints };
                }
            }
        });
        topStudentEl.textContent = topStudent.points > -1 ? `${topStudent.name} (${topStudent.points} pts)` : '-';
    }

    function populateAdminOpinions() {
        const opinions = getOpinions();
        const siteTexts = getTextContentDB();
        const adminOpinionsList = document.getElementById('admin-opinions-list');
        adminOpinionsList.innerHTML = '';
        if (opinions.length === 0) {
            adminOpinionsList.innerHTML = `<p style="text-align:center; opacity: 0.7;">لا توجد آراء لعرضها.</p>`;
        } else {
            opinions.forEach((opinion) => {
                const card = document.createElement('div');
                card.className = 'opinion-card';
                const date = new Date(opinion.timestamp).toLocaleString();
                const yearText = siteTexts[`year_${opinion.year}`] || opinion.year;
                const majorText = opinion.major;
                card.innerHTML = `<button class="delete-btn" data-id="${opinion.id}" title="حذف الرأي">&times;</button><div class="opinion-card-header"><div class="opinion-author-details"><span class="opinion-author">${opinion.name}</span><span class="opinion-meta">${majorText} - ${yearText}</span></div><span class="opinion-timestamp">${date}</span></div><p class="opinion-text">${opinion.opinion}</p>`;
                adminOpinionsList.appendChild(card);
            });
        }
    }

    function populateStudentList() {
        const users = getUsersDB();
        const lang = htmlEl.lang || 'ar';
        const siteTexts = getTextContentDB();
        let tableHTML = `<table><thead><tr><th>الاسم</th><th>الفرقة/الشعبة</th><th>كلمة المرور</th><th>الدولة/المحافظة</th><th>النقاط</th><th>الإجراءات</th></tr></thead><tbody>`;
        Object.keys(users).forEach(username => {
            if (username === 'admen') return;
            const user = users[username];
            const profile = user.profile;
            const data = user.data || {};
            const isBanned = data.banned || false;
            const yearText = siteTexts[`year_${profile.year}`] || profile.year;
            const points = data.points || 0;
            const location = `${profile.governorate || 'N/A'}, ${profile.country || 'N/A'}`;
            tableHTML += `<tr class="${isBanned ? 'banned' : ''}"><td>${profile.name}</td><td>${yearText} - ${profile.major}</td><td>${user.password}</td><td>${location}</td><td>${points}</td><td><div class="action-btns"><button class="ban-btn" data-username="${profile.name}">${isBanned ? 'فك الحظر' : 'حظر'}</button><button class="delete-student-btn" data-username="${profile.name}">حذف</button></div></td></tr>`;
        });
        tableHTML += `</tbody></table>`;
        adminStudentListContainer.innerHTML = tableHTML;
    }
    
    function createContentManagementUI(contentType, container) {
        container.innerHTML = `<form class="content-management-form"><select class="input-group admin-year-select" required><option value="">اختر الفرقة</option><option value="1">الأولى</option><option value="2">الثانية</option><option value="3">الثالثة</option><option value="4">الرابعة</option></select><select class="input-group admin-major-select" required><option value="">اختر الشعبة</option></select><select class="input-group admin-semester-select" required><option value="1">الفصل الدراسي الأول</option><option value="2">الفصل الدراسي الثاني</option></select></form><ul class="admin-subjects-list"></ul>`;
        const yearSelectAdmin = container.querySelector('.admin-year-select');
        const majorSelectAdmin = container.querySelector('.admin-major-select');
        const semesterSelectAdmin = container.querySelector('.admin-semester-select');
        const subjectsList = container.querySelector('.admin-subjects-list');
        const render = () => renderSubjectsForAdmin(yearSelectAdmin.value, majorSelectAdmin.value, semesterSelectAdmin.value, subjectsList, contentType);
        
        yearSelectAdmin.addEventListener('change', () => { updateMajors(yearSelectAdmin.value, majorSelectAdmin); semesterSelectAdmin.value = '1'; render(); });
        majorSelectAdmin.addEventListener('change', () => { semesterSelectAdmin.value = '1'; render(); });
        semesterSelectAdmin.addEventListener('change', render);
    }
    
    function renderSubjectsForAdmin(year, major, semester, listElement, contentType) {
        listElement.innerHTML = '';
        if (year && major && semester) {
            const coursesData = getCoursesDB();
            const subjects = coursesData[year]?.[major]?.[semester] || [];
            if(subjects.length === 0) {
                listElement.innerHTML = `<li>لا توجد مواد دراسية لهذا الاختيار.</li>`;
            } else {
                subjects.forEach((subject) => {
                    const li = document.createElement('li');
                    li.innerHTML = `<span>${subject}</span><button class="manage-btn" data-subject="${subject}"><i class="fas fa-edit"></i> إدارة</button>`;
                    li.querySelector('.manage-btn').addEventListener('click', () => openContentEditor(subject, contentType));
                    listElement.appendChild(li);
                });
            }
        }
    }
    
    function openContentEditor(subject, contentType) {
        const lang = htmlEl.lang || 'ar';
        const typeTranslations = {lectures: 'المحاضرات', pdfs: 'الكتب', sections: 'السكاشن'};
        document.getElementById('content-editor-title').textContent = `إدارة ${typeTranslations[contentType]}: ${subject}`;
        const editorContent = document.getElementById('content-editor-content');
        
        const contentForms = {
            lectures: `
                <div id="lectures-list-admin" class="details-view-list"></div>
                <form id="add-lecture-form" class="content-management-form" style="flex-direction:column; gap: 15px; margin-top: 15px;">
                    <div class="input-group"><input type="text" id="new-lecture-title" placeholder=" " required><label>عنوان المحاضرة (مثال: المحاضرة الأولى)</label></div>
                    <div class="input-group"><select id="new-lecture-type"><option value="text">نص</option><option value="video">فيديو (رابط يوتيوب)</option></select></div>
                    <div class="input-group" id="lecture-content-input-area"><textarea id="new-lecture-content" placeholder=" " style="height: 100px;"></textarea><label>محتوى المحاضرة</label></div>
                    <button type="submit" class="submit-btn" style="font-size: 1rem; padding: 10px; margin-top: 0;">إضافة محاضرة</button>
                </form>`,
            pdfs: `
                <div id="pdfs-list-admin" class="details-view-list"></div>
                <form id="add-pdf-form" class="content-management-form" style="flex-direction:column; gap: 15px; margin-top: 15px;">
                    <div class="input-group"><input type="text" id="new-pdf-title" placeholder=" " required><label>عنوان الكتاب</label></div>
                    <div class="input-group"><input type="url" id="new-pdf-url" placeholder=" " required><label>رابط الملف</label></div>
                    <button type="submit" class="submit-btn" style="font-size: 1rem; padding: 10px; margin-top: 0;">إضافة كتاب</button>
                </form>`,
            sections: `
                <div id="sections-list-admin" class="details-view-list"></div>
                 <form id="add-section-form" class="content-management-form" style="flex-direction:column; gap: 15px; margin-top: 15px;">
                    <div class="input-group"><input type="text" id="new-section-title" placeholder=" " required><label>عنوان السكشن</label></div>
                    <div class="input-group"><textarea id="new-section-content" placeholder=" " style="height: 100px;"></textarea><label>محتوى السكشن</label></div>
                    <button type="submit" class="submit-btn" style="font-size: 1rem; padding: 10px; margin-top: 0;">إضافة سكشن</button>
                </form>`
        };

        editorContent.innerHTML = `<div class="editor-section">${contentForms[contentType]}</div>`;
        
        renderAdminContentLists(subject, contentType);
        contentEditorModal.classList.add('active');

        if (contentType === 'lectures') {
            document.getElementById('add-lecture-form').addEventListener('submit', (e) => handleAddContent(e, subject, 'lectures'));
            document.getElementById('new-lecture-type').addEventListener('change', toggleLectureInput);
        } else if (contentType === 'pdfs') {
            document.getElementById('add-pdf-form').addEventListener('submit', (e) => handleAddContent(e, subject, 'pdfs'));
        } else if (contentType === 'sections') {
            document.getElementById('add-section-form').addEventListener('submit', (e) => handleAddContent(e, subject, 'sections'));
        }
    }
    
    function toggleLectureInput() {
        const type = document.getElementById('new-lecture-type').value;
        const area = document.getElementById('lecture-content-input-area');
        if (type === 'video') {
            area.innerHTML = `<input type="url" id="new-lecture-content" placeholder=" " required><label>رابط فيديو يوتيوب (Embed)</label>`;
        } else {
            area.innerHTML = `<textarea id="new-lecture-content" placeholder=" " style="height: 100px;"></textarea><label>محتوى المحاضرة</label>`;
        }
    }
    
    function handleAddContent(e, subject, type) {
        e.preventDefault();
        const contentDB = getContentDB();
        if (!contentDB[subject]) contentDB[subject] = { lectures: [], pdfs: [], sections: [] };

        let newItem = { id: Date.now(), isPublished: false }; // Unique ID + Default to not published
        if (type === 'lectures') {
            const title = document.getElementById('new-lecture-title').value.trim();
            const lectureType = document.getElementById('new-lecture-type').value;
            const content = document.getElementById('new-lecture-content').value.trim();
            if(!title || !content) return;
            newItem = { ...newItem, title, type: lectureType, [lectureType === 'text' ? 'content' : 'url']: content };
        } else if (type === 'pdfs') {
            const title = document.getElementById('new-pdf-title').value.trim();
            const url = document.getElementById('new-pdf-url').value.trim();
            if(!title || !url) return;
            newItem = { ...newItem, title, url, type: 'pdf' };
        } else if (type === 'sections') {
            const title = document.getElementById('new-section-title').value.trim();
            const content = document.getElementById('new-section-content').value.trim();
            if(!title || !content) return;
            newItem = { ...newItem, title, content, type: 'text' };
        }
        
        contentDB[subject][type].push(newItem);
        saveContentDB(contentDB);
        renderAdminContentLists(subject, type);
        e.target.reset();
    }
    
    function handleDeleteContent(subject, type, id) {
        if (confirm('هل أنت متأكد من حذف هذا العنصر؟')) {
            const contentDB = getContentDB();
            if (contentDB[subject] && contentDB[subject][type]) {
                contentDB[subject][type] = contentDB[subject][type].filter(item => item.id != id);
                saveContentDB(contentDB);
                renderAdminContentLists(subject, type);
            }
        }
    }
    
    function handleTogglePublish(subject, type, id) {
        const contentDB = getContentDB();
        const item = contentDB[subject]?.[type]?.find(i => i.id == id);
        if (item) {
            item.isPublished = !item.isPublished;
            saveContentDB(contentDB);
            renderAdminContentLists(subject, type);
        }
    }

    function renderAdminContentLists(subject, type) {
        const contentDB = getContentDB();
        const subjectContent = contentDB[subject] || { lectures: [], pdfs: [], sections: [] };
        const container = document.getElementById(`${type}-list-admin`);
        
        container.innerHTML = '';
        if (subjectContent[type] && subjectContent[type].length > 0) {
            subjectContent[type].forEach((item) => {
                const itemEl = document.createElement('div');
                itemEl.className = 'detail-item';
                const isPublished = item.isPublished;
                itemEl.innerHTML = `
                    <span>${item.title}</span>
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="fas ${isPublished ? 'fa-toggle-on' : 'fa-toggle-off'} publish-toggle ${isPublished ? 'published' : 'not-published'}" data-id="${item.id}" title="${isPublished ? 'إخفاء' : 'نشر'}"></i>
                        <button class="delete-btn" data-id="${item.id}" title="حذف"><i class="fas fa-trash"></i></button>
                    </div>
                `;
                itemEl.querySelector('.delete-btn').addEventListener('click', () => handleDeleteContent(subject, type, item.id));
                itemEl.querySelector('.publish-toggle').addEventListener('click', () => handleTogglePublish(subject, type, item.id));
                container.appendChild(itemEl);
            });
        } else {
             container.innerHTML = `<p style="opacity:0.6; text-align:center; padding: 10px;">لا يوجد محتوى. قم بإضافة جديد من النموذج أدناه.</p>`;
        }
    }

    function populateSiteSettings() {
        const settings = getSiteSettings();
        const meetingUrlContainer = document.getElementById('meeting-url-container');
        document.getElementById('setting-site-name').value = settings.siteName;
        document.getElementById('setting-points-unlock').value = settings.pointsToUnlock;
        document.getElementById('setting-points-lecture').value = settings.pointsPerLecture;
        document.getElementById('setting-banner-text').value = settings.bannerText;
        document.getElementById('setting-courses-unlocked').checked = settings.coursesUnlocked;
        document.getElementById('setting-meetings-unlocked').checked = settings.meetingsUnlocked;
        document.getElementById('setting-meeting-url').value = settings.meetingUrl || '';
        meetingUrlContainer.style.display = settings.meetingsUnlocked ? 'block' : 'none';
    }

    function checkAnnouncement() {
        const announcement = getAnnouncement();
        if (!announcement) return;
        const username = getCurrentUsername();
        const lastSeen = getUserData(username, 'lastSeenAnnouncement');
        if (!lastSeen || lastSeen < announcement.timestamp) {
            document.getElementById('announcement-text').textContent = announcement.message;
            announcementToast.classList.add('active');
            setUserData(username, 'lastSeenAnnouncement', announcement.timestamp);
        }
    }

    function populateAdminTextEditor() {
        const form = document.getElementById('text-editor-form');
        form.innerHTML = '';
        const currentTexts = getTextContentDB();
        const textGroups = {
            "واجهة الدخول والتسجيل": ['login_choice_btn', 'create_account_btn', 'create_account_title', 'register_btn', 'login_title_main', 'login_btn_main', 'name_placeholder', 'password_label', 'password_format_hint', 'password_forgot_hint', 'year_placeholder', 'major_placeholder', 'semester_warning_text', 'auth_error_no_account', 'auth_error_user_exists', 'auth_error_wrong_pass', 'auth_error_banned', 'captcha_enter_code', 'captcha_error'],
            "الواجهة الرئيسية": ['welcome_back', 'nav_pdf', 'nav_sections', 'nav_ai', 'nav_platform', 'nav_settings', 'nav_about', 'nav_courses', 'nav_meetings'],
            "الرسائل والتنبيهات": ['logout_msg', 'fill_all_fields', 'opinion_success', 'rating_thanks', 'blog_saved_success', 'settings_saved', 'announcement_sent', 'clear_data_confirm'],
            "نصوص الأقسام المقفولة": ['courses_locked_msg', 'meetings_locked_main', 'meetings_locked_sub', 'locked_lectures_msg', 'locked_pdfs_msg', 'locked_sections_msg'],
            "نصوص أخرى": ['points_info_main', 'points_info_dev_credit', 'pomodoro_desc', 'pomodoro_work_done', 'pomodoro_break_done']
        };

        for (const groupName in textGroups) {
            const details = document.createElement('details');
            const summary = document.createElement('summary');
            summary.textContent = groupName;
            const contentDiv = document.createElement('div');
            contentDiv.className = 'details-content';

            textGroups[groupName].forEach(key => {
                if (currentTexts[key]) {
                    const value = currentTexts[key];
                    const labelText = translations.ar[key] || key; // Use default as fallback label
                    const inputType = value.length > 100 ? 'textarea' : 'input';
                    
                    contentDiv.innerHTML += `
                        <div class="input-group">
                            ${inputType === 'textarea' ? `<textarea id="text_edit_${key}" placeholder=" ">${value}</textarea>` : `<input type="text" id="text_edit_${key}" value="${value}" placeholder=" ">`}
                            <label for="text_edit_${key}">${labelText.replace(/<[^>]*>/g, '').substring(0, 50)}</label>
                        </div>
                    `;
                }
            });
            
            details.appendChild(summary);
            details.appendChild(contentDiv);
            form.appendChild(details);
        }

        form.innerHTML += `<button type="submit" class="submit-btn" style="font-size: 1.1rem; padding: 12px; margin-top: 10px;">حفظ النصوص</button>`;
    }
    
    function populateAdminRatings() {
        const ratings = getRatings();
        const container = document.getElementById('admin-ratings-list');
        container.innerHTML = '';
        if (ratings.length === 0) {
            container.innerHTML = `<p style="text-align:center; opacity: 0.7;">لا توجد تقييمات لعرضها.</p>`;
        } else {
            ratings.forEach(rating => {
                const card = document.createElement('div');
                card.className = 'opinion-card';
                const date = new Date(rating.timestamp).toLocaleString();
                let starsHTML = '';
                for(let i = 1; i <= 5; i++){
                    starsHTML += `<i class="${i <= rating.rating ? 'fas' : 'far'} fa-star"></i>`;
                }
                card.innerHTML = `<div class="opinion-card-header">
                                    <div class="opinion-author-details">
                                        <span class="opinion-author">${rating.username}</span>
                                        <span class="opinion-meta rating-card-stars">${starsHTML}</span>
                                    </div>
                                    <span class="opinion-timestamp">${date}</span>
                                  </div>`;
                container.appendChild(card);
            });
        }
    }

    function populateAdminAiTools() {
        const tools = getAiToolsDB();
        const container = document.getElementById('admin-ai-tools-list');
        container.innerHTML = '';
        tools.forEach(tool => {
            const itemEl = document.createElement('div');
            itemEl.className = 'detail-item';
            itemEl.innerHTML = `<span>${tool.name}</span>
                              <div style="display: flex; align-items: center; gap: 15px;">
                                <button class="delete-btn" data-id="${tool.id}" title="حذف"><i class="fas fa-trash"></i></button>
                              </div>`;
            itemEl.querySelector('.delete-btn').addEventListener('click', () => {
                if (confirm(`هل أنت متأكد من حذف أداة "${tool.name}"؟`)) {
                    const newTools = getAiToolsDB().filter(t => t.id !== tool.id);
                    saveAiToolsDB(newTools);
                    populateAdminAiTools();
                }
            });
            container.appendChild(itemEl);
        });
    }
    // END: ADMIN PANEL FUNCTIONS
    
    // --- EVENT LISTENERS ---
    yearSelect.addEventListener('change', (e) => updateMajors(e.target.value, majorSelect));
    semesterSelect.addEventListener('change', () => { const lang = htmlEl.lang || 'ar'; const siteTexts = getTextContentDB(); const submitBtn = document.querySelector('#create-account-form .submit-btn'); if (semesterSelect.value === '2') { submitBtn.disabled = true; semesterWarning.textContent = siteTexts.semester_warning_text; } else { submitBtn.disabled = false; semesterWarning.textContent = ''; } });
    createAccountChoiceBtn.addEventListener('click', () => showAuthView('create'));
    loginChoiceBtn.addEventListener('click', () => { const users = getUsersDB(); if (Object.keys(users).filter(u => u !== 'admen').length === 0 && !users['admen']) { showAuthMessage('auth_error_no_account'); return; } showAuthView('login'); });
    document.querySelectorAll('.back-to-choice-btn').forEach(btn => btn.addEventListener('click', () => showAuthView('choice')));
    createAccountForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('create-name').value.trim();
        const password = document.getElementById('create-password').value;
        const userInputCaptcha = captchaInput.value;
        const country = document.getElementById('create-country').value;
        const governorate = document.getElementById('create-governorate').value;

        if (!createAccountForm.checkValidity() || !name || !yearSelect.value || !majorSelect.value) { showAuthMessage('fill_all_fields'); return; }
        if (password.length < 8 || !/^(?=.*[a-zA-Z])(?=.*[0-9])/.test(password)) { showAuthMessage(password.length < 8 ? 'password_error_length' : 'password_error_format'); return; }
        if (name.toLowerCase() === 'admen') { showAuthMessage('auth_error_user_exists'); return; }
        
        if (userInputCaptcha !== captchaText) { showAuthMessage('captcha_error'); generateNumericCaptcha(); captchaInput.value = ''; return; }

        const db = getUsersDB();
        if (db[name]) { showAuthMessage('auth_error_user_exists'); return; }
        db[name] = { password: password, profile: { name: name, year: yearSelect.value, major: majorSelect.options[majorSelect.selectedIndex].text, semester: semesterSelect.value, country, governorate }, data: { points: 0, rated: false, note: '', banned: false, viewedContent: [], lastSeenAnnouncement: null, last_active: null } };
        saveUsersDB(db);
        localStorage.setItem(LAST_USER_KEY, name);
        showAuthView('login', { newName: name, newPassword: password });
    });

    loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const name = document.getElementById('login-name').value.trim();
        const password = document.getElementById('login-password').value;
        if (!name || !password) { showAuthMessage('fill_all_fields'); return; }

        if (name.toLowerCase() === 'admen' && password === 'Amr1221@gmail.com') {
            localStorage.setItem(CURRENT_USER_KEY, 'admen');
            localStorage.setItem('moraCurrentUserRole', 'admin');
            loginPage.classList.add('exit');
            setTimeout(() => { 
                loginPage.classList.remove('active', 'exit'); 
                loadingPage.classList.add('active');
                setTimeout(() => {
                    loadingPage.classList.remove('active');
                    showAdminPanel();
                }, 1500);
            }, 700);
            return;
        }

        const db = getUsersDB();
        const user = db[name];
        if (!user || user.password !== password) { showAuthMessage('auth_error_wrong_pass'); return; }
        if (user.data?.banned) { showAuthMessage('auth_error_banned'); return; }
        
        localStorage.setItem(CURRENT_USER_KEY, name);
        localStorage.setItem('moraCurrentUserRole', 'student');
        localStorage.setItem(LAST_USER_KEY, name);
        
        loginPage.classList.add('exit');
        setTimeout(() => { 
            loginPage.classList.remove('active', 'exit'); 
            loadingPage.classList.add('active'); 
            setTimeout(() => {
                populateMainPage(user.profile); 
                loadingPage.classList.remove('active'); 
                mainPage.classList.add('active');
                checkAnnouncement();
            }, 2500);
        }, 700);
    });

    captchaRefreshBtn.addEventListener('click', generateNumericCaptcha);
    document.querySelectorAll('.password-toggle').forEach(icon => { icon.addEventListener('click', () => { const wrapper = icon.closest('.password-wrapper'); const input = wrapper.querySelector('input'); const isPassword = input.type === 'password'; input.type = isPassword ? 'text' : 'password'; icon.classList.toggle('fa-eye', !isPassword); icon.classList.toggle('fa-eye-slash', isPassword); }); });
    
    backToCoursesBtn.addEventListener('click', () => {
        mainPage.classList.remove('details-active');
        populateMainPage(getCurrentUserData()); // Go back to subjects view
    });
    meetingsBtn.addEventListener('click', () => {
        updateUserActivity();
        const settings = getSiteSettings();
        if (settings.meetingsUnlocked && settings.meetingUrl) {
            showRedirectModal(null, () => window.open(settings.meetingUrl, '_blank'));
        } else {
             meetingsLockedModal.classList.add('active');
        }
    });

    pointsCounter.addEventListener('click', () => {
        updateUserActivity();
        clearTimeout(pointsToastTimeout);
        const lang = htmlEl.lang || 'ar';
        const siteTexts = getTextContentDB();
        pointsInfoToastContent.innerHTML = `<p class="points-info-main-text" data-key="points_info_main">${siteTexts.points_info_main}</p><span class="dev-credit-toast" data-key="points_info_dev_credit">${siteTexts.points_info_dev_credit}</span>`;
        setLanguage(lang); // Re-apply to parse highlights
        pointsInfoToast.classList.add('show');

        const coursesBtnRect = coursesBtn.getBoundingClientRect();
        pointingArrow.style.left = `${coursesBtnRect.left + coursesBtnRect.width / 2}px`;
        pointingArrow.style.top = `${coursesBtnRect.top - 50}px`;
        pointingArrow.classList.add('show');
        
        pointsToastTimeout = setTimeout(() => {
            pointsInfoToast.classList.remove('show');
            pointingArrow.classList.remove('show');
        }, 4000);
    });

    closeToastBtn.addEventListener('click', () => {
        clearTimeout(pointsToastTimeout);
        pointsInfoToast.classList.remove('show');
        pointingArrow.classList.remove('show');
    });

    document.getElementById('lang-switcher').addEventListener('click', e => { if (e.target.closest('.settings-btn')?.dataset.lang) setLanguage(e.target.closest('.settings-btn').dataset.lang); });
    document.getElementById('mode-switcher').addEventListener('click', e => { if (e.target.closest('.settings-btn')?.dataset.mode) setSetting('mode', e.target.closest('.settings-btn').dataset.mode); });
    
    document.querySelectorAll('[data-modal]').forEach(trigger => { 
        trigger.addEventListener('click', () => { 
            updateUserActivity();
            const modalId = trigger.dataset.modal; 
            const modal = document.getElementById(modalId); 
            if(modal) { 
                document.querySelectorAll('.modal-overlay.active').forEach(m => m.classList.remove('active')); 
                modal.classList.add('active'); 
                if (modalId === 'about-modal') document.querySelector('.glowing-sponsors').classList.add('animate');
                if (modalId === 'opinions-modal') renderOpinions();
                if (modalId === 'ai-modal') populateAiModal();
            } 
        }); 
    });

    document.querySelectorAll('.modal-overlay').forEach(modal => {
        modal.addEventListener('click', e => {
            if (e.target === modal || e.target.closest('.close-btn')) {
                if (modal.id === 'timer-modal') {
                    modal.classList.remove('active'); // Don't reset timer, just hide
                } else {
                    modal.classList.remove('active');
                    if(modal.id === 'about-modal') { document.querySelector('.glowing-sponsors').classList.remove('animate'); }
                    if (modal.id === 'video-player-modal') { const vc = document.getElementById('video-player-container'); if (vc) vc.innerHTML = ''; }
                }
            }
        });
    });
    
    startPauseTimerBtn.addEventListener('click', startPauseTimer);
    resetTimerBtn.addEventListener('click', resetTimer);
    opinionForm.addEventListener('submit', handleOpinionSubmit);

    const rateBtn = document.getElementById('rate-website-btn'), blogBtn = document.getElementById('blog-btn'), ratingModal = document.getElementById('rating-modal'), ratingStars = ratingModal.querySelectorAll('.rating-stars i'), blogTextarea = document.getElementById('blog-textarea'), saveBlogBtn = document.getElementById('save-blog-btn'), charCounter = document.getElementById('char-counter');
    function checkRatedStatus() { const username = getCurrentUsername(); if(!username) return; const hasRated = getUserData(username, 'rated'); rateBtn.style.display = hasRated ? 'none' : 'flex'; blogBtn.style.display = hasRated ? 'flex' : 'none'; }
    ratingStars.forEach(star => { star.addEventListener('mouseover', () => { for (let i = 0; i < ratingStars.length; i++) { ratingStars[i].classList.toggle('fas', i < star.dataset.value); ratingStars[i].classList.toggle('far', i >= star.dataset.value); } }); star.addEventListener('mouseout', () => { ratingStars.forEach(s => { s.classList.remove('fas'); s.classList.add('far'); }); }); star.addEventListener('click', () => { const username = getCurrentUsername(); if(username) { setUserData(username, 'rated', true); const newRating = { username, rating: star.dataset.value, timestamp: new Date().toISOString() }; const ratings = getRatings(); ratings.unshift(newRating); saveRatings(ratings); } ratingModal.classList.remove('active'); showAuthMessage('rating_thanks'); checkRatedStatus(); document.getElementById('about-modal').classList.add('active'); }); });
    blogBtn.addEventListener('click', () => { const username = getCurrentUsername(); if(!username) return; blogTextarea.value = getUserData(username, 'note') || ''; charCounter.textContent = `${blogTextarea.value.length} / 1000`; });
    blogTextarea.addEventListener('input', () => { charCounter.textContent = `${blogTextarea.value.length} / 1000`; });
    saveBlogBtn.addEventListener('click', () => { const username = getCurrentUsername(); if(username) setUserData(username, 'note', blogTextarea.value); const siteTexts = getTextContentDB(); const originalText = siteTexts.blog_save_btn; saveBlogBtn.textContent = siteTexts.blog_saved_success; saveBlogBtn.classList.add('saved'); setTimeout(() => { saveBlogBtn.textContent = originalText; saveBlogBtn.classList.remove('saved'); }, 2000); });
    
    coursesBtn.addEventListener('click', () => {
        updateUserActivity();
        const settings = getSiteSettings();
        const points = getPoints();
        if (settings.coursesUnlocked || points >= settings.pointsToUnlock) {
            mainPage.classList.remove('details-active');
            const userData = getCurrentUserData();
            if (!userData) return;
            if (currentView === 'subjects') {
                displayVideoCategories();
            } else {
                populateMainPage(userData);
            }
        } else {
            const lang = htmlEl.lang || 'ar';
            const siteTexts = getTextContentDB();
            lockedMessageP.innerHTML = siteTexts.courses_locked_msg.replace('__UNLOCK__', settings.pointsToUnlock);
            coursesLockedModal.classList.add('active');
        }
    });

    function showRedirectModal(sourceModalId, actionCallback, customMessage) { const sourceModal = document.getElementById(sourceModalId); if (sourceModal) sourceModal.classList.remove('active'); const siteTexts = getTextContentDB(); const redirectMessageEl = redirectModal.querySelector('.redirect-message'); redirectMessageEl.textContent = customMessage || siteTexts.redirect_msg; let seconds = 3; redirectModal.classList.add('active'); timerElement.textContent = seconds; clearInterval(countdownInterval); countdownInterval = setInterval(() => { seconds--; timerElement.textContent = seconds; if (seconds <= 0) { clearInterval(countdownInterval); redirectModal.classList.remove('active'); if (typeof actionCallback === 'function') actionCallback(); } }, 1000); }
    
    function studentLogout() { 
        mainPage.classList.add('exit'); 
        setTimeout(() => { 
            mainPage.classList.remove('active', 'exit', 'details-active'); 
            coursesContainer.innerHTML = ''; 
            const lastUser = getCurrentUsername(); 
            localStorage.removeItem(CURRENT_USER_KEY);
            localStorage.removeItem('moraCurrentUserRole');
            if(lastUser) localStorage.setItem(LAST_USER_KEY, lastUser); 
            loginPage.classList.remove('exit'); 
            loginPage.classList.add('active'); 
            showAuthView('login'); 
        }, 700); 
    }
    
    function adminLogout() {
        clearInterval(activeUserInterval);
        adminPanel.classList.add('exit');
        setTimeout(() => {
            adminPanel.classList.remove('active', 'exit');
            localStorage.removeItem(CURRENT_USER_KEY);
            localStorage.removeItem('moraCurrentUserRole');
            loginPage.classList.remove('exit');
            loginPage.classList.add('active');
            showAuthView('login');
        }, 700);
    }

    document.getElementById('logout-btn').addEventListener('click', () => { const siteTexts = getTextContentDB(); showRedirectModal('about-modal', studentLogout, siteTexts.logout_msg); });
    adminLogoutBtn.addEventListener('click', () => { const siteTexts = getTextContentDB(); showRedirectModal(null, adminLogout, siteTexts.logout_msg); });
    
    document.getElementById('clear-data-btn').addEventListener('click', () => {
        const siteTexts = getTextContentDB();
        if (confirm(siteTexts.clear_data_confirm)) {
            localStorage.clear();
            location.reload();
        }
    });

    adminNavLinks.forEach(link => {
        link.addEventListener('click', e => {
            e.preventDefault();
            adminNavLinks.forEach(l => l.classList.remove('active'));
            link.classList.add('active');
            const viewId = `admin-${link.dataset.view}-view`;
            document.querySelectorAll('.admin-view').forEach(view => view.classList.remove('active'));
            if(document.getElementById(viewId)) {
                document.getElementById(viewId).classList.add('active');
            }
            if (link.dataset.view === 'dashboard') populateAdminStats();
            if (link.dataset.view === 'opinions') populateAdminOpinions();
            if (link.dataset.view === 'students') populateStudentList();
            if (link.dataset.view === 'site-settings') populateSiteSettings();
            if (link.dataset.view === 'ratings') populateAdminRatings();
            if (link.dataset.view === 'ai-tools') populateAdminAiTools();
        });
    });
    
    document.querySelectorAll('.content-view-container').forEach(container => {
        const contentType = container.parentElement.id.split('-')[2];
        createContentManagementUI(contentType, container);
    });
    
    document.getElementById('admin-opinions-list').addEventListener('click', (e) => {
        const deleteBtn = e.target.closest('.delete-btn');
        if (deleteBtn) {
            const opinionId = deleteBtn.dataset.id;
            if (confirm(`هل أنت متأكد من حذف هذا الرأي؟`)) {
                let opinions = getOpinions();
                opinions = opinions.filter(op => op.id != opinionId);
                saveOpinions(opinions);
                populateAdminOpinions();
                populateAdminStats(); // Update stats
            }
        }
    });

    adminStudentListContainer.addEventListener('click', e => {
        const btn = e.target.closest('button');
        if (!btn) return;
        
        const usernameToActOn = btn.dataset.username;
        const users = getUsersDB();
        
        if (btn.classList.contains('ban-btn')) {
            if (users[usernameToActOn]) {
                if (!users[usernameToActOn].data) users[usernameToActOn].data = {};
                users[usernameToActOn].data.banned = !users[usernameToActOn].data.banned;
                saveUsersDB(users);
                populateStudentList();
            }
        } else if (btn.classList.contains('delete-student-btn')) {
            if (confirm(`هل أنت متأكد من حذف الطالب ${usernameToActOn} نهائياً؟ لا يمكن التراجع عن هذا الإجراء.`)) {
                delete users[usernameToActOn];
                saveUsersDB(users);
                populateStudentList();
                populateAdminStats();
            }
        }
    });

    document.getElementById('site-settings-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const newSettings = {
            siteName: document.getElementById('setting-site-name').value.trim(),
            pointsToUnlock: parseInt(document.getElementById('setting-points-unlock').value),
            pointsPerLecture: parseInt(document.getElementById('setting-points-lecture').value),
            bannerText: document.getElementById('setting-banner-text').value.trim(),
            coursesUnlocked: document.getElementById('setting-courses-unlocked').checked,
            meetingsUnlocked: document.getElementById('setting-meetings-unlocked').checked,
            meetingUrl: document.getElementById('setting-meeting-url').value.trim()
        };
        saveSiteSettings(newSettings);
        updateSiteNameUI();
        document.querySelector('.scrolling-banner p').textContent = newSettings.bannerText; // Update banner live
        showAuthMessage('settings_saved');
    });

    document.getElementById('setting-meetings-unlocked').addEventListener('change', (e) => {
        document.getElementById('meeting-url-container').style.display = e.target.checked ? 'block' : 'none';
    });
    
    document.getElementById('announcement-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const text = document.getElementById('announcement-textarea').value.trim();
        if (text) {
            const newAnnouncement = { message: text, timestamp: Date.now() };
            saveAnnouncement(newAnnouncement);
            document.getElementById('current-announcement').textContent = `"${text}"`;
            showAuthMessage('announcement_sent');
            e.target.reset();
        }
    });

    document.getElementById('text-editor-form').addEventListener('submit', (e) => {
        e.preventDefault();
        const newTexts = getTextContentDB(); // Start with a copy
        const inputs = e.target.querySelectorAll('input, textarea');
        inputs.forEach(input => {
            const key = input.id.replace('text_edit_', '');
            newTexts[key] = input.value;
        });
        saveTextContentDB(newTexts);
        setLanguage(htmlEl.lang); // Refresh language to apply changes
        showAuthMessage('settings_saved');
    });

    document.getElementById('add-ai-tool-form').addEventListener('submit', e => {
        e.preventDefault();
        const nameInput = document.getElementById('new-ai-tool-name');
        const urlInput = document.getElementById('new-ai-tool-url');
        const name = nameInput.value.trim();
        const url = urlInput.value.trim();
        if (name && url) {
            const tools = getAiToolsDB();
            tools.push({ id: Date.now(), name, url });
            saveAiToolsDB(tools);
            populateAdminAiTools();
            e.target.reset();
        }
    });

    function populateAiModal() {
        const container = document.querySelector('#ai-modal .ai-container');
        container.innerHTML = '';
        const tools = getAiToolsDB();
        tools.forEach(tool => {
            const a = document.createElement('a');
            a.href = tool.url;
            a.className = 'ai-btn';
            a.target = '_blank';
            a.textContent = tool.name;
            container.appendChild(a);
        });
        container.querySelectorAll('a').forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); showRedirectModal('ai-modal', () => window.open(link.href, '_blank')); }); });
    }

    document.querySelectorAll('.social-icons a').forEach(link => { link.addEventListener('click', (e) => { e.preventDefault(); showRedirectModal(e.target.closest('.modal-overlay')?.id, () => window.open(link.href, '_blank')); }); });
    document.getElementById('platform-btn').addEventListener('click', (e) => { e.preventDefault(); updateUserActivity(); showRedirectModal(null, () => window.open('https://tanta-services.online/TantaPortal/index.php', '_blank')); });
    
    document.body.addEventListener('click', updateUserActivity, true);

    setupLoginAnimation();
    animateLoginBackground();
    window.addEventListener('resize', setupLoginAnimation);
    initializeApp();
});
</script>
</body>
</html>
